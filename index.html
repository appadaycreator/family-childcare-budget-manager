<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ファミリー養育費管理システム - 夫婦で子育て費用を効率管理</title>
    <meta name="description" content="夫婦で子供の養育費を効率的に管理するWebアプリケーション。口座管理、支出管理、夫婦同期機能を含む完全なシステム。">
    <meta name="keywords" content="養育費,子育て,家計管理,夫婦,貯金,支出管理,家計簿">
    <meta name="author" content="AppADayCreator">
    
    <!-- PWA -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi44OV44Kh44Of44Oq44O844Km6JK654Kf6KGM7aeuIn0=">
    <meta name="theme-color" content="#3B82F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="養育費管理">
    
    <!-- OGP -->
    <meta property="og:title" content="ファミリー養育費管理システム">
    <meta property="og:description" content="夫婦で子供の養育費を効率的に管理するWebアプリケーション">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://appadaycreator.github.io/family-childcare-budget-manager/">
    <meta property="og:image" content="https://via.placeholder.com/1200x630/3B82F6/ffffff?text=Family+Budget+Manager">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TXQGZRF9');</script>
    <!-- End Google Tag Manager -->
    
    <!-- CDN Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>
    
    <style>
        :root {
            --primary-color: #3B82F6;
            --secondary-color: #10B981;
            --accent-color: #F59E0B;
            --danger-color: #EF4444;
            --text-color: #1F2937;
            --bg-color: #F8FAFC;
            --card-bg: #FFFFFF;
            --border-color: #E5E7EB;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="dark"] {
            --text-color: #F9FAFB;
            --bg-color: #111827;
            --card-bg: #1F2937;
            --border-color: #374151;
        }
        
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        .font-size-xs { font-size: 0.75rem; }
        .font-size-sm { font-size: 0.875rem; }
        .font-size-base { font-size: 1rem; }
        .font-size-lg { font-size: 1.125rem; }
        .font-size-xl { font-size: 1.5rem; }
        
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.15);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563EB;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .sidebar {
            background: var(--card-bg);
            border-right: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .mobile-menu {
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .mobile-menu.active {
            transform: translateX(0);
        }
        
        .progress-bar {
            height: 8px;
            background: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            transition: width 0.3s ease;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
        }
        
        .hidden { display: none; }
        .active { display: block; }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .desktop-sidebar { display: none; }
            .mobile-header { display: block; }
        }
        
        @media (min-width: 769px) {
            .desktop-sidebar { display: block; }
            .mobile-header { display: none; }
            .mobile-menu { display: none; }
        }
        
        /* Animation */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease;
        }
        
        /* Print Optimization */
        @media print {
            .no-print { display: none !important; }
            .card { box-shadow: none; border: 1px solid #ccc; }
            body { font-size: 12px; }
        }
        
        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #9CA3AF;
        }
    </style>
</head>
<body class="font-size-base">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TXQGZRF9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div id="app" class="min-h-screen">
        <!-- Mobile Header -->
        <header class="mobile-header fixed top-0 left-0 right-0 z-50 bg-white shadow-md p-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fas fa-piggy-bank text-2xl text-blue-600"></i>
                <h1 class="text-xl font-bold text-gray-800 hidden sm:block">養育費管理</h1>
            </div>
            <div class="flex items-center gap-3">
                <button id="mobileMenuToggle" class="p-2 rounded-full hover:bg-gray-100">
                    <i class="fas fa-bars text-gray-600"></i>
                </button>
            </div>
        </header>
        
        <!-- Desktop Sidebar -->
        <aside class="desktop-sidebar fixed left-0 top-0 h-full w-64 sidebar z-40">
            <div class="p-6">
                <div class="flex items-center gap-3 mb-8">
                    <i class="fas fa-piggy-bank text-3xl text-blue-600"></i>
                    <div>
                        <h1 class="text-xl font-bold">養育費管理</h1>
                        <p class="text-sm text-gray-500">Family Budget</p>
                    </div>
                </div>
                
                <nav class="space-y-2">
                    <a href="#" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="dashboard">
                        <i class="fas fa-tachometer-alt text-blue-600"></i>
                        <span>ダッシュボード</span>
                    </a>
                    <a href="#" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="accounts">
                        <i class="fas fa-university text-green-600"></i>
                        <span>口座管理</span>
                    </a>
                    <a href="#" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="expenses">
                        <i class="fas fa-receipt text-red-600"></i>
                        <span>支出管理</span>
                    </a>
                    <a href="#" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="reports">
                        <i class="fas fa-chart-line text-purple-600"></i>
                        <span>レポート</span>
                    </a>
                    <a href="#" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="settings">
                        <i class="fas fa-cog text-gray-600"></i>
                        <span>設定</span>
                    </a>
                    <a href="how-to-use.html" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition-colors" target="_blank">
                        <i class="fas fa-question-circle text-orange-600"></i>
                        <span>使い方</span>
                    </a>
                </nav>
                
                <div class="mt-8 p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-semibold text-blue-800 mb-2">💡 お得情報</h3>
                    <p class="text-sm text-blue-700 mb-3">学資保険の見直しで教育費を効率化</p>
                    <a href="#" class="text-xs text-blue-600 hover:underline">詳細を見る</a>
                </div>
            </div>
        </aside>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="mobile-menu fixed top-0 right-0 h-full w-80 bg-white shadow-lg z-50 p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">メニュー</h2>
                <button id="closeMobileMenu" class="p-2 hover:bg-gray-100 rounded-full">
                    <i class="fas fa-times text-gray-600"></i>
                </button>
            </div>
            
            <nav class="space-y-3">
                <a href="#" class="nav-item block p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="dashboard">
                    <i class="fas fa-tachometer-alt text-blue-600 mr-3"></i>
                    ダッシュボード
                </a>
                <a href="#" class="nav-item block p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="accounts">
                    <i class="fas fa-university text-green-600 mr-3"></i>
                    口座管理
                </a>
                <a href="#" class="nav-item block p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="expenses">
                    <i class="fas fa-receipt text-red-600 mr-3"></i>
                    支出管理
                </a>
                <a href="#" class="nav-item block p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="reports">
                    <i class="fas fa-chart-line text-purple-600 mr-3"></i>
                    レポート
                </a>
                <a href="#" class="nav-item block p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="settings">
                    <i class="fas fa-cog text-gray-600 mr-3"></i>
                    設定
                </a>
                <a href="how-to-use.html" class="nav-item block p-3 rounded-lg hover:bg-gray-100 transition-colors" target="_blank">
                    <i class="fas fa-question-circle text-orange-600 mr-3"></i>
                    使い方
                </a>
            </nav>
        </div>
        
        <!-- Main Content -->
        <main class="md:ml-64 pt-20 md:pt-0 min-h-screen">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active p-6">
                <div class="max-w-7xl mx-auto">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">ダッシュボード</h1>
                        <p class="text-gray-600">今月の貯蓄状況と支出を確認しましょう</p>
                    </div>
                    
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">今月の貯蓄額</p>
                                    <p class="text-2xl font-bold text-green-600">¥85,000</p>
                                </div>
                                <i class="fas fa-piggy-bank text-3xl text-green-600"></i>
                            </div>
                            <div class="mt-4">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 85%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">目標: ¥100,000</p>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">今月の支出</p>
                                    <p class="text-2xl font-bold text-red-600">¥120,000</p>
                                </div>
                                <i class="fas fa-receipt text-3xl text-red-600"></i>
                            </div>
                            <div class="mt-4">
                                <p class="text-xs text-gray-500">前月比: <span class="text-red-500">+5%</span></p>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">総貯蓄額</p>
                                    <p class="text-2xl font-bold text-blue-600">¥1,250,000</p>
                                </div>
                                <i class="fas fa-university text-3xl text-blue-600"></i>
                            </div>
                            <div class="mt-4">
                                <p class="text-xs text-gray-500">3つの口座</p>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">目標達成率</p>
                                    <p class="text-2xl font-bold text-purple-600">78%</p>
                                </div>
                                <i class="fas fa-target text-3xl text-purple-600"></i>
                            </div>
                            <div class="mt-4">
                                <p class="text-xs text-gray-500">年間目標まで</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">月別貯蓄推移</h3>
                            <div class="chart-container">
                                <canvas id="savingsChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">支出カテゴリ別</h3>
                            <div class="chart-container">
                                <canvas id="expensesChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Transactions -->
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">最近の取引</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-shopping-cart text-blue-600"></i>
                                    <div>
                                        <p class="font-medium">食費</p>
                                        <p class="text-sm text-gray-500">2024/01/15</p>
                                    </div>
                                </div>
                                <span class="text-red-600 font-semibold">-¥8,500</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-graduation-cap text-green-600"></i>
                                    <div>
                                        <p class="font-medium">教育費貯蓄</p>
                                        <p class="text-sm text-gray-500">2024/01/15</p>
                                    </div>
                                </div>
                                <span class="text-green-600 font-semibold">+¥50,000</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-baby text-purple-600"></i>
                                    <div>
                                        <p class="font-medium">子供用品</p>
                                        <p class="text-sm text-gray-500">2024/01/14</p>
                                    </div>
                                </div>
                                <span class="text-red-600 font-semibold">-¥12,000</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Accounts Page -->
            <div id="accounts" class="page hidden p-6">
                <div class="max-w-7xl mx-auto">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">口座管理</h1>
                            <p class="text-gray-600">貯蓄口座の管理と目標設定</p>
                        </div>
                        <button id="addAccountBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            口座追加
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="card p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold">教育費口座</h3>
                                <div class="flex items-center gap-2">
                                    <button class="edit-account-btn text-gray-400 hover:text-gray-600" data-account="education">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-3xl font-bold text-blue-600">¥850,000</p>
                                <p class="text-sm text-gray-500">現在の残高</p>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>月間目標</span>
                                    <span>¥50,000</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 90%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">今月: ¥45,000</p>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>貯蓄目標</span>
                                    <span>¥2,000,000</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill bg-green-500" style="width: 42.5%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">目標達成率: 42.5%</p>
                            </div>
                            <button class="btn btn-primary w-full">
                                <i class="fas fa-plus"></i>
                                入金記録
                            </button>
                        </div>
                        
                        <div class="card p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold">習い事口座</h3>
                                <div class="flex items-center gap-2">
                                    <button class="edit-account-btn text-gray-400 hover:text-gray-600" data-account="hobby">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-3xl font-bold text-green-600">¥320,000</p>
                                <p class="text-sm text-gray-500">現在の残高</p>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>月間目標</span>
                                    <span>¥30,000</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 75%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">今月: ¥22,500</p>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>貯蓄目標</span>
                                    <span>¥500,000</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill bg-green-500" style="width: 64%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">目標達成率: 64%</p>
                            </div>
                            <button class="btn btn-primary w-full">
                                <i class="fas fa-plus"></i>
                                入金記録
                            </button>
                        </div>
                        
                        <div class="card p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold">緊急時口座</h3>
                                <div class="flex items-center gap-2">
                                    <button class="edit-account-btn text-gray-400 hover:text-gray-600" data-account="emergency">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-3xl font-bold text-yellow-600">¥80,000</p>
                                <p class="text-sm text-gray-500">現在の残高</p>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>月間目標</span>
                                    <span>¥20,000</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 60%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">今月: ¥12,000</p>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>貯蓄目標</span>
                                    <span>¥300,000</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill bg-green-500" style="width: 26.7%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">目標達成率: 26.7%</p>
                            </div>
                            <button class="btn btn-primary w-full">
                                <i class="fas fa-plus"></i>
                                入金記録
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Expenses Page -->
            <div id="expenses" class="page hidden p-6">
                <div class="max-w-7xl mx-auto">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">支出管理</h1>
                            <p class="text-gray-600">日々の支出を記録・分析</p>
                        </div>
                        <button id="addExpenseBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            支出追加
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="lg:col-span-2">
                            <div class="card p-6">
                                <h3 class="text-lg font-semibold mb-4">支出履歴</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between p-4 border rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center">
                                                <i class="fas fa-shopping-cart text-red-600"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium">食費</p>
                                                <p class="text-sm text-gray-500">スーパーマーケット - 2024/01/15</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-lg font-semibold text-red-600">¥8,500</p>
                                            <button class="text-gray-400 hover:text-gray-600">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 border rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
                                                <i class="fas fa-baby text-purple-600"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium">子供用品</p>
                                                <p class="text-sm text-gray-500">ベビー用品店 - 2024/01/14</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-lg font-semibold text-red-600">¥12,000</p>
                                            <button class="text-gray-400 hover:text-gray-600">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 border rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                                <i class="fas fa-graduation-cap text-blue-600"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium">教育費</p>
                                                <p class="text-sm text-gray-500">塾代 - 2024/01/13</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-lg font-semibold text-red-600">¥25,000</p>
                                            <button class="text-gray-400 hover:text-gray-600">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-6">
                            <div class="card p-6">
                                <h3 class="text-lg font-semibold mb-4">今月の支出</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">食費</span>
                                        <span class="font-semibold">¥45,000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">子供用品</span>
                                        <span class="font-semibold">¥28,000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">教育費</span>
                                        <span class="font-semibold">¥35,000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">医療費</span>
                                        <span class="font-semibold">¥12,000</span>
                                    </div>
                                    <hr>
                                    <div class="flex justify-between text-lg font-bold">
                                        <span>合計</span>
                                        <span>¥120,000</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card p-6">
                                <h3 class="text-lg font-semibold mb-4">💰 お得情報</h3>
                                <div class="space-y-3">
                                    <div class="p-3 bg-green-50 rounded-lg">
                                        <p class="text-sm font-medium text-green-800">子供用品特価セール</p>
                                        <p class="text-xs text-green-600">最大50%OFF</p>
                                    </div>
                                    <div class="p-3 bg-blue-50 rounded-lg">
                                        <p class="text-sm font-medium text-blue-800">教育ローン相談</p>
                                        <p class="text-xs text-blue-600">無料相談実施中</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Reports Page -->
            <div id="reports" class="page hidden p-6">
                <div class="max-w-7xl mx-auto">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">レポート</h1>
                        <p class="text-gray-600">詳細な分析とレポート機能</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">年間貯蓄推移</h3>
                            <div class="chart-container">
                                <canvas id="yearlyChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">支出分析</h3>
                            <div class="chart-container">
                                <canvas id="expenseAnalysisChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">詳細レポート</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto">
                                <thead>
                                    <tr class="bg-gray-50">
                                        <th class="px-4 py-3 text-left">月</th>
                                        <th class="px-4 py-3 text-left">貯蓄額</th>
                                        <th class="px-4 py-3 text-left">支出額</th>
                                        <th class="px-4 py-3 text-left">差額</th>
                                        <th class="px-4 py-3 text-left">達成率</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b">
                                        <td class="px-4 py-3">2024年1月</td>
                                        <td class="px-4 py-3 text-green-600">¥85,000</td>
                                        <td class="px-4 py-3 text-red-600">¥120,000</td>
                                        <td class="px-4 py-3 text-red-600">-¥35,000</td>
                                        <td class="px-4 py-3">85%</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="px-4 py-3">2023年12月</td>
                                        <td class="px-4 py-3 text-green-600">¥95,000</td>
                                        <td class="px-4 py-3 text-red-600">¥110,000</td>
                                        <td class="px-4 py-3 text-red-600">-¥15,000</td>
                                        <td class="px-4 py-3">95%</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="px-4 py-3">2023年11月</td>
                                        <td class="px-4 py-3 text-green-600">¥100,000</td>
                                        <td class="px-4 py-3 text-red-600">¥105,000</td>
                                        <td class="px-4 py-3 text-red-600">-¥5,000</td>
                                        <td class="px-4 py-3">100%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Page -->
            <div id="settings" class="page hidden p-6">
                <div class="max-w-4xl mx-auto">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">設定</h1>
                        <p class="text-gray-600">アプリの設定とカスタマイズ</p>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">表示設定</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium">言語</p>
                                        <p class="text-sm text-gray-500">表示言語を選択</p>
                                    </div>
                                    <select id="languageSelect" class="input-field w-32">
                                        <option value="ja">日本語</option>
                                        <option value="en">English</option>
                                    </select>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium">文字サイズ</p>
                                        <p class="text-sm text-gray-500">読みやすさを調整</p>
                                    </div>
                                    <select id="fontSizeSelect" class="input-field w-32">
                                        <option value="xs">極小</option>
                                        <option value="sm">小</option>
                                        <option value="base" selected>標準</option>
                                        <option value="lg">大</option>
                                        <option value="xl">特大</option>
                                    </select>
                                </div>
                                

                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">通知設定</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium">月末レポート</p>
                                        <p class="text-sm text-gray-500">毎月の振り返りレポート</p>
                                    </div>
                                    <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600 transition-colors">
                                        <span class="inline-block h-4 w-4 transform translate-x-6 rounded-full bg-white transition-transform"></span>
                                    </button>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium">目標達成アラート</p>
                                        <p class="text-sm text-gray-500">貯蓄目標達成時の通知</p>
                                    </div>
                                    <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600 transition-colors">
                                        <span class="inline-block h-4 w-4 transform translate-x-6 rounded-full bg-white transition-transform"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">データ管理</h3>
                            <div class="space-y-4">
                                <button class="btn btn-secondary">
                                    <i class="fas fa-download"></i>
                                    データをエクスポート
                                </button>
                                <button class="btn btn-primary">
                                    <i class="fas fa-sync-alt"></i>
                                    データを同期
                                </button>
                                <button class="btn btn-danger">
                                    <i class="fas fa-trash"></i>
                                    データを削除
                                </button>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">アプリ情報</h3>
                            <div class="space-y-2">
                                <p class="text-sm text-gray-600">バージョン: 1.0.0</p>
                                <p class="text-sm text-gray-600">最終更新: 2024年1月15日</p>
                                <div class="flex gap-4 mt-4">
                                    <a href="#" class="text-blue-600 hover:underline">利用規約</a>
                                    <a href="#" class="text-blue-600 hover:underline">プライバシーポリシー</a>
                                    <a href="#" class="text-blue-600 hover:underline">お問い合わせ</a>
                                </div>
                                <div class="mt-4 pt-4 border-t border-gray-200">
                                    <p class="text-xs text-gray-500 text-center">
                                        © 2024 ファミリー養育費管理システム. All rights reserved.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Landing Page -->
            <div id="landing" class="page hidden">
                <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                    <div class="container mx-auto px-4 py-16">
                        <div class="text-center mb-16">
                            <h1 class="text-5xl font-bold text-gray-800 mb-4">
                                ファミリー養育費管理システム
                            </h1>
                            <p class="text-xl text-gray-600 mb-8">
                                夫婦で子供の養育費を効率的に管理し、将来の教育費を計画的に貯蓄
                            </p>
                            <button class="btn btn-primary text-lg px-8 py-4">
                                今すぐ始める
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
                            <div class="text-center">
                                <i class="fas fa-piggy-bank text-4xl text-blue-600 mb-4"></i>
                                <h3 class="text-xl font-semibold mb-3">効率的な貯蓄管理</h3>
                                <p class="text-gray-600">教育費、習い事、緊急時など目的別に口座を管理し、月額目標を設定して計画的に貯蓄できます。</p>
                            </div>
                            
                            <div class="text-center">
                                <i class="fas fa-users text-4xl text-green-600 mb-4"></i>
                                <h3 class="text-xl font-semibold mb-3">夫婦でリアルタイム同期</h3>
                                <p class="text-gray-600">夫婦間で貯蓄状況と支出をリアルタイムで共有し、家計管理を効率化できます。</p>
                            </div>
                            
                            <div class="text-center">
                                <i class="fas fa-chart-line text-4xl text-purple-600 mb-4"></i>
                                <h3 class="text-xl font-semibold mb-3">詳細な分析・レポート</h3>
                                <p class="text-gray-600">月次・年次のレポートで支出傾向を分析し、将来の教育費計画を立てられます。</p>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <h2 class="text-3xl font-bold text-gray-800 mb-8">完全無料で利用可能</h2>
                            <p class="text-lg text-gray-600 mb-8">
                                GitHub Pages上で動作し、運用費は一切かかりません。<br>
                                今すぐ始めて、家族の将来を計画しましょう。
                            </p>
                            <button class="btn btn-primary text-lg px-8 py-4">
                                アカウント作成
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Share Modal -->
        <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">結果をシェア</h3>
                <div class="space-y-3">
                    <button class="btn btn-primary w-full">
                        <i class="fab fa-twitter"></i>
                        Twitter でシェア
                    </button>
                    <button class="btn btn-secondary w-full">
                        <i class="fab fa-facebook"></i>
                        Facebook でシェア
                    </button>
                    <button class="btn btn-primary w-full">
                        <i class="fab fa-line"></i>
                        LINE でシェア
                    </button>
                </div>
                <button id="closeShareModal" class="mt-4 text-gray-500 hover:text-gray-700">
                    閉じる
                </button>
            </div>
        </div>
        
        <!-- Add Account Modal -->
        <div id="addAccountModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">新しい口座を追加</h3>
                <form id="addAccountForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">口座名</label>
                        <input type="text" class="input-field" placeholder="例: 教育費口座" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">月間目標額</label>
                        <input type="number" class="input-field" placeholder="50000" required>
                    </div>
                    <div class="flex gap-3">
                        <button type="submit" class="btn btn-primary flex-1">追加</button>
                        <button type="button" id="closeAddAccountModal" class="btn btn-secondary">キャンセル</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Edit Account Modal -->
        <div id="editAccountModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">口座を編集</h3>
                <form id="editAccountForm" class="space-y-4">
                    <input type="hidden" id="editAccountId" name="accountId">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">口座名</label>
                        <input type="text" id="editAccountName" name="name" class="input-field" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">現在の残高</label>
                        <input type="number" id="editAccountBalance" name="balance" class="input-field" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">月間目標額</label>
                        <input type="number" id="editAccountGoal" name="monthlyGoal" class="input-field" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">貯蓄目標額</label>
                        <input type="number" id="editAccountTarget" name="targetAmount" class="input-field" placeholder="例: 1000000">
                    </div>
                    <div class="flex gap-3">
                        <button type="submit" class="btn btn-primary flex-1">更新</button>
                        <button type="button" id="closeEditAccountModal" class="btn btn-secondary">キャンセル</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Add Expense Modal -->
        <div id="addExpenseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">支出を追加</h3>
                <form id="addExpenseForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">カテゴリ</label>
                        <select class="input-field" required>
                            <option value="">選択してください</option>
                            <option value="food">食費</option>
                            <option value="childcare">子供用品</option>
                            <option value="education">教育費</option>
                            <option value="medical">医療費</option>
                            <option value="clothing">衣服</option>
                            <option value="entertainment">娯楽</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">金額</label>
                        <input type="number" class="input-field" placeholder="8500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">説明</label>
                        <input type="text" class="input-field" placeholder="例: スーパーマーケット">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">日付</label>
                        <input type="date" class="input-field" required>
                    </div>
                    <div class="flex gap-3">
                        <button type="submit" class="btn btn-primary flex-1">追加</button>
                        <button type="button" id="closeAddExpenseModal" class="btn btn-secondary">キャンセル</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let currentLanguage = 'ja';
        let currentFontSize = 'base';
        let isDarkMode = false;
        let supabase = null;
        let currentUser = null;
        
        // Supabase configuration
        const SUPABASE_URL = 'https://wtkdtskqqgtdjlcdmktr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind0a2R0c2txcWd0ZGpsY2Rta3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIxODI3NDEsImV4cCI6MjA2Nzc1ODc0MX0.2B7aJ8aeYINDchblUE3bA4ikRB94053LUzmGwW8MAzo';
        
        // Initialize Supabase
        try {
            if (window.supabase) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('Supabase initialized successfully');
            } else {
                console.warn('Supabase library not loaded, using demo mode');
                // Fallback for demo mode
                supabase = null;
            }
        } catch (error) {
            console.error('Supabase initialization error:', error);
            // Fallback for demo mode
            supabase = null;
        }
        
        // DOM elements
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const closeMobileMenu = document.getElementById('closeMobileMenu');
        const mobileMenu = document.getElementById('mobileMenu');
        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page');
        const themeToggle = document.getElementById('themeToggle');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const languageSelect = document.getElementById('languageSelect');
        const fontSizeSelect = document.getElementById('fontSizeSelect');
        
        // Translations
        const translations = {
            ja: {
                dashboard: 'ダッシュボード',
                accounts: '口座管理',
                expenses: '支出管理',
                reports: 'レポート',
                settings: '設定',
                thisMonth: '今月の貯蓄額',
                monthlyExpenses: '今月の支出',
                totalSavings: '総貯蓄額',
                goalProgress: '目標達成率',
                recentTransactions: '最近の取引',
                addAccount: '口座追加',
                addExpense: '支出追加'
            },
            en: {
                dashboard: 'Dashboard',
                accounts: 'Accounts',
                expenses: 'Expenses',
                reports: 'Reports',
                settings: 'Settings',
                thisMonth: 'This Month Savings',
                monthlyExpenses: 'Monthly Expenses',
                totalSavings: 'Total Savings',
                goalProgress: 'Goal Progress',
                recentTransactions: 'Recent Transactions',
                addAccount: 'Add Account',
                addExpense: 'Add Expense'
            }
        };
        
        // Chart instances
        let savingsChart = null;
        let expensesChart = null;
        let yearlyChart = null;
        let expenseAnalysisChart = null;
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('Initializing app...');
                initializeApp();
                setupEventListeners();
                loadUserPreferences();
                
                // Wait a bit for external scripts to load
                setTimeout(() => {
                    try {
                        initializeCharts();
                    } catch (chartError) {
                        console.warn('Chart initialization failed:', chartError);
                    }
                }, 1000);
                
                checkAuthStatus();
                console.log('App initialization complete');
            } catch (error) {
                console.error('App initialization error:', error);
                // Fallback: show dashboard even if there's an error
                showPage('dashboard');
            }
        });
        
        function initializeApp() {
            // Show dashboard by default
            showPage('dashboard');
            
            // Initialize PWA - Service Worker registration moved to end of file
        }
        
        function setupEventListeners() {
            // Mobile menu
            mobileMenuToggle.addEventListener('click', () => {
                mobileMenu.classList.add('active');
            });
            
            closeMobileMenu.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
            });
            
            // Navigation
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = item.getAttribute('data-page');
                    showPage(page);
                    mobileMenu.classList.remove('active');
                });
            });
            
            // Account edit buttons
            document.querySelectorAll('.edit-account-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const accountType = btn.getAttribute('data-account');
                    openEditAccountModal(accountType);
                });
            });
            
            // Settings
            languageSelect.addEventListener('change', changeLanguage);
            fontSizeSelect.addEventListener('change', changeFontSize);
            
            // Modals
            document.getElementById('addAccountBtn').addEventListener('click', () => {
                document.getElementById('addAccountModal').classList.remove('hidden');
            });
            
            document.getElementById('addExpenseBtn').addEventListener('click', () => {
                document.getElementById('addExpenseModal').classList.remove('hidden');
            });
            
            document.getElementById('closeAddAccountModal').addEventListener('click', () => {
                document.getElementById('addAccountModal').classList.add('hidden');
            });
            
            document.getElementById('closeAddExpenseModal').addEventListener('click', () => {
                document.getElementById('addExpenseModal').classList.add('hidden');
            });
            
            document.getElementById('closeEditAccountModal').addEventListener('click', () => {
                document.getElementById('editAccountModal').classList.add('hidden');
            });
            
            // Forms
            document.getElementById('addAccountForm').addEventListener('submit', handleAddAccount);
            document.getElementById('editAccountForm').addEventListener('submit', handleEditAccount);
            document.getElementById('addExpenseForm').addEventListener('submit', handleAddExpense);
            
            // Share functionality
            document.getElementById('closeShareModal').addEventListener('click', () => {
                document.getElementById('shareModal').classList.add('hidden');
            });
        }
        
        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
                page.classList.add('hidden');
            });
            
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('active');
                targetPage.classList.add('slide-in');
            }
            
            // Update active navigation
            navItems.forEach(item => {
                item.classList.remove('bg-blue-50', 'text-blue-700');
                if (item.getAttribute('data-page') === pageId) {
                    item.classList.add('bg-blue-50', 'text-blue-700');
                }
            });
        }
        
        function openEditAccountModal(accountType) {
            const modal = document.getElementById('editAccountModal');
            const form = document.getElementById('editAccountForm');
            
            // Set account data based on type
            const accountData = getAccountData(accountType);
            
            document.getElementById('editAccountId').value = accountType;
            document.getElementById('editAccountName').value = accountData.name;
            document.getElementById('editAccountBalance').value = accountData.balance;
            document.getElementById('editAccountGoal').value = accountData.monthlyGoal;
            document.getElementById('editAccountTarget').value = accountData.targetAmount || '';
            
            modal.classList.remove('hidden');
        }
        
        function getAccountData(accountType) {
            const accounts = {
                education: {
                    name: '教育費口座',
                    balance: 850000,
                    monthlyGoal: 50000,
                    targetAmount: 2000000
                },
                hobby: {
                    name: '習い事口座',
                    balance: 320000,
                    monthlyGoal: 30000,
                    targetAmount: 500000
                },
                emergency: {
                    name: '緊急時口座',
                    balance: 80000,
                    monthlyGoal: 20000,
                    targetAmount: 300000
                }
            };
            
            return accounts[accountType] || {};
        }
        
        function changeLanguage() {
            currentLanguage = languageSelect.value;
            updateLanguage();
            saveUserPreferences();
        }
        
        function changeFontSize() {
            currentFontSize = fontSizeSelect.value;
            document.body.className = document.body.className.replace(/font-size-\w+/, `font-size-${currentFontSize}`);
            saveUserPreferences();
        }
        
        function updateLanguage() {
            const t = translations[currentLanguage];
            
            // Update navigation
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (t[key]) {
                    element.textContent = t[key];
                }
            });
        }
        
        function saveUserPreferences() {
            const preferences = {
                language: currentLanguage,
                fontSize: currentFontSize
            };
            localStorage.setItem('userPreferences', JSON.stringify(preferences));
        }
        
        function loadUserPreferences() {
            const stored = localStorage.getItem('userPreferences');
            if (stored) {
                const preferences = JSON.parse(stored);
                currentLanguage = preferences.language || 'ja';
                currentFontSize = preferences.fontSize || 'base';
                
                languageSelect.value = currentLanguage;
                fontSizeSelect.value = currentFontSize;
                
                updateLanguage();
                changeFontSize();
            }
        }
        
        function initializeCharts() {
            try {
                // Check if Chart.js is loaded
                if (typeof Chart === 'undefined') {
                    console.warn('Chart.js not loaded, skipping chart initialization');
                    return;
                }
                
                // Savings chart
                const savingsCtx = document.getElementById('savingsChart');
                if (savingsCtx) {
                    savingsChart = new Chart(savingsCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                            datasets: [{
                                label: '貯蓄額',
                                data: [80000, 85000, 90000, 87000, 92000, 85000],
                                borderColor: '#10B981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '¥' + value.toLocaleString();
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Expenses chart
                const expensesCtx = document.getElementById('expensesChart');
                if (expensesCtx) {
                    expensesChart = new Chart(expensesCtx.getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: ['食費', '子供用品', '教育費', '医療費', 'その他'],
                            datasets: [{
                                data: [45000, 28000, 35000, 12000, 8000],
                                backgroundColor: [
                                    '#EF4444',
                                    '#8B5CF6',
                                    '#3B82F6',
                                    '#10B981',
                                    '#F59E0B'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }
                
                // Yearly chart
                const yearlyCtx = document.getElementById('yearlyChart');
                if (yearlyCtx) {
                    yearlyChart = new Chart(yearlyCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ['2020', '2021', '2022', '2023', '2024'],
                            datasets: [{
                                label: '年間貯蓄額',
                                data: [800000, 950000, 1100000, 1200000, 1250000],
                                backgroundColor: '#3B82F6'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '¥' + value.toLocaleString();
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Expense analysis chart
                const expenseAnalysisCtx = document.getElementById('expenseAnalysisChart');
                if (expenseAnalysisCtx) {
                    expenseAnalysisChart = new Chart(expenseAnalysisCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                            datasets: [{
                                label: '食費',
                                data: [40000, 42000, 45000, 43000, 47000, 45000],
                                borderColor: '#EF4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)'
                            }, {
                                label: '教育費',
                                data: [30000, 32000, 35000, 33000, 37000, 35000],
                                borderColor: '#3B82F6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '¥' + value.toLocaleString();
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Chart initialization error:', error);
            }
        }
        
        function handleAddAccount(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const accountData = {
                name: formData.get('name'),
                monthlyGoal: parseInt(formData.get('monthlyGoal')),
                balance: 0,
                userId: currentUser?.id
            };
            
            // Add to Supabase (when configured)
            // addAccountToDatabase(accountData);
            
            document.getElementById('addAccountModal').classList.add('hidden');
            e.target.reset();
        }
        
        function handleAddExpense(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const expenseData = {
                category: formData.get('category'),
                amount: parseInt(formData.get('amount')),
                description: formData.get('description'),
                date: formData.get('date'),
                userId: currentUser?.id
            };
            
            // Add to Supabase (when configured)
            // addExpenseToDatabase(expenseData);
            
            document.getElementById('addExpenseModal').classList.add('hidden');
            e.target.reset();
        }
        
        function handleEditAccount(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const accountData = {
                id: formData.get('accountId'),
                name: formData.get('name'),
                balance: parseInt(formData.get('balance')),
                monthlyGoal: parseInt(formData.get('monthlyGoal')),
                targetAmount: parseInt(formData.get('targetAmount')) || 0,
                userId: currentUser?.id
            };
            
            // Update account data in UI
            updateAccountDisplay(accountData);
            
            // Add to Supabase (when configured)
            // updateAccountInDatabase(accountData);
            
            document.getElementById('editAccountModal').classList.add('hidden');
        }
        
        function updateAccountDisplay(accountData) {
            // Update the account display based on account type
            const accountType = accountData.id;
            const accountCards = {
                education: document.querySelector('[data-account="education"]').closest('.card'),
                hobby: document.querySelector('[data-account="hobby"]').closest('.card'),
                emergency: document.querySelector('[data-account="emergency"]').closest('.card')
            };
            
            const card = accountCards[accountType];
            if (card) {
                // Update account name
                card.querySelector('h3').textContent = accountData.name;
                
                // Update balance
                const balanceElement = card.querySelector('.text-3xl');
                balanceElement.textContent = `¥${accountData.balance.toLocaleString()}`;
                
                // Update monthly goal
                const goalElement = card.querySelector('.text-sm:last-of-type');
                if (goalElement && goalElement.textContent.includes('¥')) {
                    goalElement.textContent = `¥${accountData.monthlyGoal.toLocaleString()}`;
                }
                
                // Update target amount if exists
                const targetElement = card.querySelector('.text-sm:contains("貯蓄目標")');
                if (targetElement && accountData.targetAmount > 0) {
                    const progress = (accountData.balance / accountData.targetAmount * 100).toFixed(1);
                    const progressBar = card.querySelector('.progress-fill.bg-green-500');
                    if (progressBar) {
                        progressBar.style.width = `${Math.min(progress, 100)}%`;
                    }
                    const progressText = card.querySelector('.text-xs:contains("目標達成率")');
                    if (progressText) {
                        progressText.textContent = `目標達成率: ${progress}%`;
                    }
                }
            }
        }
        
        function checkAuthStatus() {
            // Check if user is logged in
            const userSession = localStorage.getItem('userSession');
            if (userSession) {
                try {
                    currentUser = JSON.parse(userSession);
                    showDashboard();
                } catch (error) {
                    console.error('Session parsing error:', error);
                    localStorage.removeItem('userSession');
                    showAuthModal();
                }
            } else {
                // For demo purposes, show dashboard directly
                // In production, you would show auth modal here
                handleDemoLogin();
            }
        }
        
        function showAuthModal() {
            // Create and show authentication modal
            const authModal = document.createElement('div');
            authModal.innerHTML = `
                <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
                    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                        <h3 class="text-xl font-semibold mb-4">ログイン・新規登録</h3>
                        <form id="authForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">メールアドレス</label>
                                <input type="email" name="email" class="input-field" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">パスワード</label>
                                <input type="password" name="password" class="input-field" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-full">ログイン</button>
                        </form>
                        <p class="text-center text-sm text-gray-600 mt-4">
                            アカウントをお持ちでない場合は、自動的に新規登録されます
                        </p>
                        <div class="text-center mt-4">
                            <button id="demoLogin" class="text-blue-600 hover:text-blue-800 text-sm">
                                デモモードで試す
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(authModal);
            
            // Add event listeners
            const authForm = authModal.querySelector('#authForm');
            const demoLoginBtn = authModal.querySelector('#demoLogin');
            
            authForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(authForm);
                const email = formData.get('email');
                const password = formData.get('password');
                
                // Handle authentication
                handleAuthentication(email, password);
            });
            
            demoLoginBtn.addEventListener('click', () => {
                handleDemoLogin();
            });
        }
        
        function handleAuthentication(email, password) {
            try {
                // Initialize Supabase if not already done
                if (!supabase) {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                }
                
                // Try to sign in
                supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                }).then(({ data, error }) => {
                    if (error) {
                        // If sign in fails, try to sign up
                        supabase.auth.signUp({
                            email: email,
                            password: password
                        }).then(({ data: signUpData, error: signUpError }) => {
                            if (signUpError) {
                                console.error('Sign up error:', signUpError);
                                showNotification('エラー', '認証に失敗しました: ' + signUpError.message, 'error');
                            } else {
                                showNotification('成功', 'アカウントを作成しました。確認メールをチェックしてください。', 'success');
                                // For demo purposes, proceed anyway
                                handleDemoLogin();
                            }
                        }).catch(error => {
                            console.error('Sign up catch error:', error);
                            showNotification('エラー', '認証に失敗しました', 'error');
                            handleDemoLogin();
                        });
                    } else {
                        showNotification('成功', 'ログインしました', 'success');
                        currentUser = data.user;
                        localStorage.setItem('userSession', JSON.stringify(data.user));
                        showDashboard();
                    }
                }).catch(error => {
                    console.error('Sign in catch error:', error);
                    showNotification('エラー', '認証に失敗しました', 'error');
                    handleDemoLogin();
                });
            } catch (error) {
                console.error('Authentication setup error:', error);
                showNotification('エラー', '認証システムの初期化に失敗しました', 'error');
                handleDemoLogin();
            }
        }
        
        function handleDemoLogin() {
            currentUser = { id: 'demo-user', email: 'demo@example.com' };
            localStorage.setItem('userSession', JSON.stringify(currentUser));
            const authModal = document.querySelector('.fixed.inset-0');
            if (authModal) {
                document.body.removeChild(authModal);
            }
            showDashboard();
        }
        
        function showDashboard() {
            // Hide auth modal if exists
            const authModal = document.querySelector('.fixed.inset-0');
            if (authModal) {
                document.body.removeChild(authModal);
            }
            
            // Show dashboard page
            showPage('dashboard');
            
            // Update navigation active state
            navItems.forEach(item => {
                item.classList.remove('bg-blue-50', 'text-blue-700');
            });
            
            const dashboardNav = document.querySelector('[data-page="dashboard"]');
            if (dashboardNav) {
                dashboardNav.classList.add('bg-blue-50', 'text-blue-700');
            }
        }
        
        // Share functionality
        function shareResults(platform) {
            const url = window.location.href;
            const text = '家族の養育費管理を効率化！月額貯蓄と支出を見える化するアプリを使っています。';
            
            let shareUrl = '';
            switch (platform) {
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
                    break;
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
                    break;
                case 'line':
                    shareUrl = `https://line.me/R/msg/text/?${encodeURIComponent(text + ' ' + url)}`;
                    break;
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
            }
        }
        
        // PWA install prompt
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            deferredPrompt = e;
            showInstallPrompt();
        });
        
        function showInstallPrompt() {
            const installBanner = document.createElement('div');
            installBanner.innerHTML = `
                <div class="fixed bottom-4 left-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-50">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-mobile-alt text-2xl"></i>
                            <div>
                                <p class="font-semibold">アプリをインストール</p>
                                <p class="text-sm opacity-90">ホーム画面に追加して簡単アクセス</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button id="installApp" class="btn btn-primary">インストール</button>
                            <button id="dismissInstall" class="btn btn-secondary">後で</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(installBanner);
            
            document.getElementById('installApp').addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        deferredPrompt = null;
                        document.body.removeChild(installBanner);
                    });
                }
            });
            
            document.getElementById('dismissInstall').addEventListener('click', () => {
                document.body.removeChild(installBanner);
            });
        }
        
        // Offline functionality
        function handleOffline() {
            const offlineBanner = document.createElement('div');
            offlineBanner.innerHTML = `
                <div class="fixed top-0 left-0 right-0 bg-yellow-500 text-white p-2 text-center z-50">
                    <i class="fas fa-wifi-slash mr-2"></i>
                    オフラインモードで動作中
                </div>
            `;
            document.body.appendChild(offlineBanner);
        }
        
        function handleOnline() {
            const offlineBanner = document.querySelector('.fixed.top-0.bg-yellow-500');
            if (offlineBanner) {
                document.body.removeChild(offlineBanner);
            }
        }
        
        window.addEventListener('offline', handleOffline);
        window.addEventListener('online', handleOnline);
        
        // Error handling
        window.addEventListener('error', (e) => {
            console.error('Application error:', e);
            // Show user-friendly error message
            const errorToast = document.createElement('div');
            errorToast.innerHTML = `
                <div class="fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <p class="font-semibold">エラーが発生しました</p>
                            <p class="text-sm">ページを再読み込みしてください</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(errorToast);
            
            setTimeout(() => {
                document.body.removeChild(errorToast);
            }, 5000);
        });
        
        // Performance monitoring
        if ('performance' in window) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    console.log('Page load time:', perfData.loadEventEnd - perfData.loadEventStart);
                }, 0);
            });
        }
        
        // Analytics tracking (Google Analytics)
        function trackEvent(eventName, category, action, label) {
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, {
                    event_category: category,
                    event_action: action,
                    event_label: label
                });
            }
        }
        
        // Usage tracking
        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                const page = item.getAttribute('data-page');
                trackEvent('navigation', 'click', page);
            });
        });
        
        // Accessibility enhancements
        document.addEventListener('keydown', (e) => {
            // ESC key to close modals
            if (e.key === 'Escape') {
                document.querySelectorAll('.fixed.inset-0').forEach(modal => {
                    if (!modal.classList.contains('hidden')) {
                        modal.classList.add('hidden');
                    }
                });
            }
            
            // Tab navigation for accessibility
            if (e.key === 'Tab') {
                document.body.classList.add('keyboard-navigation');
            }
        });
        
        document.addEventListener('mousedown', () => {
            document.body.classList.remove('keyboard-navigation');
        });
        
        // Focus management
        function trapFocus(modal) {
            const focusableElements = modal.querySelectorAll(
                'button, input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];
            
            modal.addEventListener('keydown', (e) => {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstElement) {
                            lastElement.focus();
                            e.preventDefault();
                        }
                    } else {
                        if (document.activeElement === lastElement) {
                            firstElement.focus();
                            e.preventDefault();
                        }
                    }
                }
            });
            
            firstElement.focus();
        }
        
        // Initialize focus trap for modals
        document.querySelectorAll('.fixed.inset-0').forEach(modal => {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        if (!modal.classList.contains('hidden')) {
                            trapFocus(modal);
                        }
                    }
                });
            });
            
            observer.observe(modal, { attributes: true });
        });
        
        // Data persistence
        function saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error('Failed to save to localStorage:', e);
            }
        }
        
        function loadFromLocalStorage(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.error('Failed to load from localStorage:', e);
                return null;
            }
        }
        
        // Export/Import functionality
        function exportData() {
            const data = {
                accounts: loadFromLocalStorage('accounts') || [],
                expenses: loadFromLocalStorage('expenses') || [],
                settings: loadFromLocalStorage('userPreferences') || {}
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'family-budget-data.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function importData(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    saveToLocalStorage('accounts', data.accounts);
                    saveToLocalStorage('expenses', data.expenses);
                    saveToLocalStorage('userPreferences', data.settings);
                    location.reload();
                } catch (error) {
                    alert('インポートに失敗しました。ファイル形式を確認してください。');
                }
            };
            reader.readAsText(file);
        }
        
        // Backup and sync
        function createBackup() {
            const backup = {
                timestamp: new Date().toISOString(),
                data: {
                    accounts: loadFromLocalStorage('accounts') || [],
                    expenses: loadFromLocalStorage('expenses') || [],
                    settings: loadFromLocalStorage('userPreferences') || {}
                }
            };
            
            saveToLocalStorage('backup', backup);
        }
        
        // Create backup every hour
        setInterval(createBackup, 3600000);
        
        // Initialize backup on load
        createBackup();
        
        // Search functionality
        function searchTransactions(query) {
            const transactions = loadFromLocalStorage('expenses') || [];
            return transactions.filter(transaction => 
                transaction.description.toLowerCase().includes(query.toLowerCase()) ||
                transaction.category.toLowerCase().includes(query.toLowerCase())
            );
        }
        
        // Add search to expenses page
        const expensesPage = document.getElementById('expenses');
        const searchInput = document.createElement('input');
        searchInput.type = 'text';
        searchInput.placeholder = '支出を検索...';
        searchInput.className = 'input-field mb-4';
        searchInput.addEventListener('input', (e) => {
            const results = searchTransactions(e.target.value);
            // Update expense list with search results
            // Implementation depends on your data structure
        });
        
        // Add to expenses page
        const expensesContent = expensesPage.querySelector('.max-w-7xl');
        if (expensesContent) {
            expensesContent.insertBefore(searchInput, expensesContent.firstChild);
        }
        
        // Notification system
        function showNotification(title, message, type = 'info') {
            const notification = document.createElement('div');
            const typeColors = {
                info: 'bg-blue-500',
                success: 'bg-green-500',
                warning: 'bg-yellow-500',
                error: 'bg-red-500'
            };
            
            notification.innerHTML = `
                <div class="fixed top-4 right-4 ${typeColors[type]} text-white p-4 rounded-lg shadow-lg z-50 max-w-sm">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'info-circle'} text-xl"></i>
                        <div>
                            <h4 class="font-semibold">${title}</h4>
                            <p class="text-sm">${message}</p>
                        </div>
                        <button class="text-white hover:text-gray-200 ml-2">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            notification.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(notification);
            });
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 5000);
        }
        
        // Budget alerts
        function checkBudgetAlerts() {
            const expenses = loadFromLocalStorage('expenses') || [];
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthlyExpenses = expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.getMonth() === currentMonth && 
                       expenseDate.getFullYear() === currentYear;
            });
            
            const totalExpenses = monthlyExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            const budgetLimit = 150000; // Example budget limit
            
            if (totalExpenses > budgetLimit * 0.8) {
                showNotification(
                    '予算アラート',
                    `今月の支出が予算の80%を超えました。現在: ¥${totalExpenses.toLocaleString()}`,
                    'warning'
                );
            }
        }
        
        // Check budget alerts on page load
        checkBudgetAlerts();
        
        // Update last activity timestamp
        function updateLastActivity() {
            saveToLocalStorage('lastActivity', new Date().toISOString());
        }
        
        // Update activity on user interaction
        document.addEventListener('click', updateLastActivity);
        document.addEventListener('keydown', updateLastActivity);
        
        // Cleanup function
        function cleanup() {
            // Clean up event listeners and timers
            if (savingsChart) savingsChart.destroy();
            if (expensesChart) expensesChart.destroy();
            if (yearlyChart) yearlyChart.destroy();
            if (expenseAnalysisChart) expenseAnalysisChart.destroy();
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', cleanup);
        
        // Initialize tooltips
        function initializeTooltips() {
            const tooltips = document.querySelectorAll('[data-tooltip]');
            tooltips.forEach(element => {
                element.addEventListener('mouseenter', showTooltip);
                element.addEventListener('mouseleave', hideTooltip);
            });
        }
        
        function showTooltip(e) {
            const tooltip = document.createElement('div');
            tooltip.className = 'absolute bg-gray-800 text-white p-2 rounded text-sm z-50';
            tooltip.textContent = e.target.getAttribute('data-tooltip');
            
            document.body.appendChild(tooltip);
            
            const rect = e.target.getBoundingClientRect();
            tooltip.style.left = rect.left + 'px';
            tooltip.style.top = (rect.bottom + 5) + 'px';
        }
        
        function hideTooltip() {
            const tooltip = document.querySelector('.absolute.bg-gray-800');
            if (tooltip) {
                document.body.removeChild(tooltip);
            }
        }
        
        // Initialize on load
        initializeTooltips();
    </script>
    
    <!-- Service Worker -->
    <script>
        const SW_CODE = `
            const CACHE_NAME = 'family-budget-v1';
            const urlsToCache = [
                '/',
                '/index.html',
                'https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css',
                'https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css',
                'https://cdn.jsdelivr.net/npm/chart.js'
            ];
            
            self.addEventListener('install', (event) => {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then((cache) => cache.addAll(urlsToCache))
                );
            });
            
            self.addEventListener('fetch', (event) => {
                event.respondWith(
                    caches.match(event.request)
                        .then((response) => {
                            if (response) {
                                return response;
                            }
                            return fetch(event.request);
                        })
                );
            });
        `;
        
        // Create service worker blob
        const swBlob = new Blob([SW_CODE], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(swBlob);
        
        if ('serviceWorker' in navigator) {
            try {
                // Try external sw.js first
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => console.log('External SW registered successfully'))
                    .catch(error => {
                        console.log('External SW registration failed:', error);
                        // Fallback to inline SW
                        navigator.serviceWorker.register(swUrl)
                            .then(registration => console.log('Inline SW registered successfully'))
                            .catch(inlineError => console.log('Inline SW also failed:', inlineError));
                    });
            } catch (error) {
                console.error('Service Worker setup error:', error);
            }
        }
    </script>
    
    <!-- PWA Manifest -->
    <script>
        const manifest = {
            name: 'ファミリー養育費管理システム',
            short_name: '養育費管理',
            description: '夫婦で子供の養育費を効率的に管理するWebアプリケーション',
            start_url: '/',
            display: 'standalone',
            background_color: '#ffffff',
            theme_color: '#3B82F6',
            icons: [
                {
                    src: 'https://via.placeholder.com/192x192/3B82F6/ffffff?text=FB',
                    sizes: '192x192',
                    type: 'image/png'
                },
                {
                    src: 'https://via.placeholder.com/512x512/3B82F6/ffffff?text=FB',
                    sizes: '512x512',
                    type: 'image/png'
                }
            ]
        };
        
        const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
        const manifestUrl = URL.createObjectURL(manifestBlob);
        
        const manifestLink = document.createElement('link');
        manifestLink.rel = 'manifest';
        manifestLink.href = manifestUrl;
        document.head.appendChild(manifestLink);
    </script>
</body>
</html>