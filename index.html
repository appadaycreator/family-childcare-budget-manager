<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ•ã‚¡ãƒŸãƒªãƒ¼é¤Šè‚²è²»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - å¤«å©¦ã§å­è‚²ã¦è²»ç”¨ã‚’åŠ¹ç‡ç®¡ç†</title>
    <meta name="description" content="å¤«å©¦ã§å­ä¾›ã®é¤Šè‚²è²»ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚å£åº§ç®¡ç†ã€æ”¯å‡ºç®¡ç†ã€å¤«å©¦åŒæœŸæ©Ÿèƒ½ã‚’å«ã‚€å®Œå…¨ãªã‚·ã‚¹ãƒ†ãƒ ã€‚">
    <meta name="keywords" content="é¤Šè‚²è²»,å­è‚²ã¦,å®¶è¨ˆç®¡ç†,å¤«å©¦,è²¯é‡‘,æ”¯å‡ºç®¡ç†,å®¶è¨ˆç°¿">
    <meta name="author" content="AppADayCreator">
    
    <!-- PWA -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi44OV44Kh44Of44Oq44O844Km6JK654Kf6KGM7aeuIn0=">
    <meta name="theme-color" content="#3B82F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="é¤Šè‚²è²»ç®¡ç†">
    
    <!-- OGP -->
    <meta property="og:title" content="ãƒ•ã‚¡ãƒŸãƒªãƒ¼é¤Šè‚²è²»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ">
    <meta property="og:description" content="å¤«å©¦ã§å­ä¾›ã®é¤Šè‚²è²»ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://appadaycreator.github.io/family-childcare-budget-manager/">
    <meta property="og:image" content="https://via.placeholder.com/1200x630/3B82F6/ffffff?text=Family+Budget+Manager">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TXQGZRF9');</script>
    <!-- End Google Tag Manager -->
    
    <!-- CDN Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>
    
    <style>
        :root {
            --primary-color: #3B82F6;
            --secondary-color: #10B981;
            --accent-color: #F59E0B;
            --danger-color: #EF4444;
            --text-color: #1F2937;
            --bg-color: #F8FAFC;
            --card-bg: #FFFFFF;
            --border-color: #E5E7EB;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="dark"] {
            --text-color: #F9FAFB;
            --bg-color: #111827;
            --card-bg: #1F2937;
            --border-color: #374151;
        }
        
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        .font-size-xs { font-size: 0.75rem; }
        .font-size-sm { font-size: 0.875rem; }
        .font-size-base { font-size: 1rem; }
        .font-size-lg { font-size: 1.125rem; }
        .font-size-xl { font-size: 1.5rem; }
        
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.15);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563EB;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .sidebar {
            background: var(--card-bg);
            border-right: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .mobile-menu {
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .mobile-menu.active {
            transform: translateX(0);
        }
        
        .progress-bar {
            height: 8px;
            background: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            transition: width 0.3s ease;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
        }
        
        .hidden { display: none; }
        .active { display: block; }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .desktop-sidebar { display: none; }
            .mobile-header { display: block; }
        }
        
        @media (min-width: 769px) {
            .desktop-sidebar { display: block; }
            .mobile-header { display: none; }
            .mobile-menu { display: none; }
        }
        
        /* Animation */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease;
        }
        
        /* Print Optimization */
        @media print {
            .no-print { display: none !important; }
            .card { box-shadow: none; border: 1px solid #ccc; }
            body { font-size: 12px; }
        }
        
        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #9CA3AF;
        }
    </style>
</head>
<body class="font-size-base">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TXQGZRF9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div id="app" class="min-h-screen">
        <!-- Mobile Header -->
        <header class="mobile-header fixed top-0 left-0 right-0 z-50 bg-white shadow-md p-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fas fa-piggy-bank text-2xl text-blue-600"></i>
                <h1 class="text-xl font-bold text-gray-800 hidden sm:block">é¤Šè‚²è²»ç®¡ç†</h1>
            </div>
            <div class="flex items-center gap-3">
                <button id="mobileMenuToggle" class="p-2 rounded-full hover:bg-gray-100">
                    <i class="fas fa-bars text-gray-600"></i>
                </button>
            </div>
        </header>
        
        <!-- Desktop Sidebar -->
        <aside class="desktop-sidebar fixed left-0 top-0 h-full w-64 sidebar z-40">
            <div class="p-6">
                <div class="flex items-center gap-3 mb-8">
                    <i class="fas fa-piggy-bank text-3xl text-blue-600"></i>
                    <div>
                        <h1 class="text-xl font-bold">é¤Šè‚²è²»ç®¡ç†</h1>
                        <p class="text-sm text-gray-500">Family Budget</p>
                    </div>
                </div>
                
                <nav class="space-y-2">
                    <a href="#" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="dashboard">
                        <i class="fas fa-tachometer-alt text-blue-600"></i>
                        <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
                    </a>
                    <a href="#" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="accounts">
                        <i class="fas fa-university text-green-600"></i>
                        <span>å£åº§ç®¡ç†</span>
                    </a>
                    <a href="#" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="expenses">
                        <i class="fas fa-receipt text-red-600"></i>
                        <span>æ”¯å‡ºç®¡ç†</span>
                    </a>
                    <a href="#" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="reports">
                        <i class="fas fa-chart-line text-purple-600"></i>
                        <span>ãƒ¬ãƒãƒ¼ãƒˆ</span>
                    </a>
                    <a href="#" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="settings">
                        <i class="fas fa-cog text-gray-600"></i>
                        <span>è¨­å®š</span>
                    </a>
                    <a href="how-to-use.html" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition-colors" target="_blank">
                        <i class="fas fa-question-circle text-orange-600"></i>
                        <span>ä½¿ã„æ–¹</span>
                    </a>
                </nav>
                
                <div class="mt-8 p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-semibold text-blue-800 mb-2">ğŸ’¡ ãŠå¾—æƒ…å ±</h3>
                    <p class="text-sm text-blue-700 mb-3">å­¦è³‡ä¿é™ºã®è¦‹ç›´ã—ã§æ•™è‚²è²»ã‚’åŠ¹ç‡åŒ–</p>
                    <a href="#" class="text-xs text-blue-600 hover:underline">è©³ç´°ã‚’è¦‹ã‚‹</a>
                </div>
            </div>
        </aside>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="mobile-menu fixed top-0 right-0 h-full w-80 bg-white shadow-lg z-50 p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
                <button id="closeMobileMenu" class="p-2 hover:bg-gray-100 rounded-full">
                    <i class="fas fa-times text-gray-600"></i>
                </button>
            </div>
            
            <nav class="space-y-3">
                <a href="#" class="nav-item block p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="dashboard">
                    <i class="fas fa-tachometer-alt text-blue-600 mr-3"></i>
                    ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                </a>
                <a href="#" class="nav-item block p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="accounts">
                    <i class="fas fa-university text-green-600 mr-3"></i>
                    å£åº§ç®¡ç†
                </a>
                <a href="#" class="nav-item block p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="expenses">
                    <i class="fas fa-receipt text-red-600 mr-3"></i>
                    æ”¯å‡ºç®¡ç†
                </a>
                <a href="#" class="nav-item block p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="reports">
                    <i class="fas fa-chart-line text-purple-600 mr-3"></i>
                    ãƒ¬ãƒãƒ¼ãƒˆ
                </a>
                <a href="#" class="nav-item block p-3 rounded-lg hover:bg-gray-100 transition-colors" data-page="settings">
                    <i class="fas fa-cog text-gray-600 mr-3"></i>
                    è¨­å®š
                </a>
                <a href="how-to-use.html" class="nav-item block p-3 rounded-lg hover:bg-gray-100 transition-colors" target="_blank">
                    <i class="fas fa-question-circle text-orange-600 mr-3"></i>
                    ä½¿ã„æ–¹
                </a>
            </nav>
        </div>
        
        <!-- Main Content -->
        <main class="md:ml-64 pt-20 md:pt-0 min-h-screen">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active p-6">
                <div class="max-w-7xl mx-auto">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
                        <p class="text-gray-600">ä»Šæœˆã®è²¯è“„çŠ¶æ³ã¨æ”¯å‡ºã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†</p>
                    </div>
                    
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">ä»Šæœˆã®è²¯è“„é¡</p>
                                    <p class="text-2xl font-bold text-green-600">Â¥85,000</p>
                                </div>
                                <i class="fas fa-piggy-bank text-3xl text-green-600"></i>
                            </div>
                            <div class="mt-4">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 85%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">ç›®æ¨™: Â¥100,000</p>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">ä»Šæœˆã®æ”¯å‡º</p>
                                    <p class="text-2xl font-bold text-red-600">Â¥120,000</p>
                                </div>
                                <i class="fas fa-receipt text-3xl text-red-600"></i>
                            </div>
                            <div class="mt-4">
                                <p class="text-xs text-gray-500">å‰æœˆæ¯”: <span class="text-red-500">+5%</span></p>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">ç·è²¯è“„é¡</p>
                                    <p class="text-2xl font-bold text-blue-600">Â¥1,250,000</p>
                                </div>
                                <i class="fas fa-university text-3xl text-blue-600"></i>
                            </div>
                            <div class="mt-4">
                                <p class="text-xs text-gray-500">3ã¤ã®å£åº§</p>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">ç›®æ¨™é”æˆç‡</p>
                                    <p class="text-2xl font-bold text-purple-600">78%</p>
                                </div>
                                <i class="fas fa-target text-3xl text-purple-600"></i>
                            </div>
                            <div class="mt-4">
                                <p class="text-xs text-gray-500">å¹´é–“ç›®æ¨™ã¾ã§</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">æœˆåˆ¥è²¯è“„æ¨ç§»</h3>
                            <div class="chart-container">
                                <canvas id="savingsChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">æ”¯å‡ºã‚«ãƒ†ã‚´ãƒªåˆ¥</h3>
                            <div class="chart-container">
                                <canvas id="expensesChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Transactions -->
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">æœ€è¿‘ã®å–å¼•</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-shopping-cart text-blue-600"></i>
                                    <div>
                                        <p class="font-medium">é£Ÿè²»</p>
                                        <p class="text-sm text-gray-500">2024/01/15</p>
                                    </div>
                                </div>
                                <span class="text-red-600 font-semibold">-Â¥8,500</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-graduation-cap text-green-600"></i>
                                    <div>
                                        <p class="font-medium">æ•™è‚²è²»è²¯è“„</p>
                                        <p class="text-sm text-gray-500">2024/01/15</p>
                                    </div>
                                </div>
                                <span class="text-green-600 font-semibold">+Â¥50,000</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-baby text-purple-600"></i>
                                    <div>
                                        <p class="font-medium">å­ä¾›ç”¨å“</p>
                                        <p class="text-sm text-gray-500">2024/01/14</p>
                                    </div>
                                </div>
                                <span class="text-red-600 font-semibold">-Â¥12,000</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Accounts Page -->
            <div id="accounts" class="page hidden p-6">
                <div class="max-w-7xl mx-auto">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">å£åº§ç®¡ç†</h1>
                            <p class="text-gray-600">è²¯è“„å£åº§ã®ç®¡ç†ã¨ç›®æ¨™è¨­å®š</p>
                        </div>
                        <button id="addAccountBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            å£åº§è¿½åŠ 
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="card p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold">æ•™è‚²è²»å£åº§</h3>
                                <div class="flex items-center gap-2">
                                    <button class="edit-account-btn text-gray-400 hover:text-gray-600" data-account="education">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-3xl font-bold text-blue-600">Â¥850,000</p>
                                <p class="text-sm text-gray-500">ç¾åœ¨ã®æ®‹é«˜</p>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>æœˆé–“ç›®æ¨™</span>
                                    <span>Â¥50,000</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 90%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">ä»Šæœˆ: Â¥45,000</p>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>è²¯è“„ç›®æ¨™</span>
                                    <span>Â¥2,000,000</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill bg-green-500" style="width: 42.5%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">ç›®æ¨™é”æˆç‡: 42.5%</p>
                            </div>
                            <button class="btn btn-primary w-full">
                                <i class="fas fa-plus"></i>
                                å…¥é‡‘è¨˜éŒ²
                            </button>
                        </div>
                        
                        <div class="card p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold">ç¿’ã„äº‹å£åº§</h3>
                                <div class="flex items-center gap-2">
                                    <button class="edit-account-btn text-gray-400 hover:text-gray-600" data-account="hobby">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-3xl font-bold text-green-600">Â¥320,000</p>
                                <p class="text-sm text-gray-500">ç¾åœ¨ã®æ®‹é«˜</p>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>æœˆé–“ç›®æ¨™</span>
                                    <span>Â¥30,000</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 75%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">ä»Šæœˆ: Â¥22,500</p>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>è²¯è“„ç›®æ¨™</span>
                                    <span>Â¥500,000</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill bg-green-500" style="width: 64%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">ç›®æ¨™é”æˆç‡: 64%</p>
                            </div>
                            <button class="btn btn-primary w-full">
                                <i class="fas fa-plus"></i>
                                å…¥é‡‘è¨˜éŒ²
                            </button>
                        </div>
                        
                        <div class="card p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold">ç·Šæ€¥æ™‚å£åº§</h3>
                                <div class="flex items-center gap-2">
                                    <button class="edit-account-btn text-gray-400 hover:text-gray-600" data-account="emergency">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-3xl font-bold text-yellow-600">Â¥80,000</p>
                                <p class="text-sm text-gray-500">ç¾åœ¨ã®æ®‹é«˜</p>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>æœˆé–“ç›®æ¨™</span>
                                    <span>Â¥20,000</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 60%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">ä»Šæœˆ: Â¥12,000</p>
                            </div>
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>è²¯è“„ç›®æ¨™</span>
                                    <span>Â¥300,000</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill bg-green-500" style="width: 26.7%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">ç›®æ¨™é”æˆç‡: 26.7%</p>
                            </div>
                            <button class="btn btn-primary w-full">
                                <i class="fas fa-plus"></i>
                                å…¥é‡‘è¨˜éŒ²
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Expenses Page -->
            <div id="expenses" class="page hidden p-6">
                <div class="max-w-7xl mx-auto">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">æ”¯å‡ºç®¡ç†</h1>
                            <p class="text-gray-600">æ—¥ã€…ã®æ”¯å‡ºã‚’è¨˜éŒ²ãƒ»åˆ†æ</p>
                        </div>
                        <button id="addExpenseBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            æ”¯å‡ºè¿½åŠ 
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="lg:col-span-2">
                            <div class="card p-6">
                                <h3 class="text-lg font-semibold mb-4">æ”¯å‡ºå±¥æ­´</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between p-4 border rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center">
                                                <i class="fas fa-shopping-cart text-red-600"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium">é£Ÿè²»</p>
                                                <p class="text-sm text-gray-500">ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒãƒ¼ã‚±ãƒƒãƒˆ - 2024/01/15</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-lg font-semibold text-red-600">Â¥8,500</p>
                                            <button class="text-gray-400 hover:text-gray-600">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 border rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
                                                <i class="fas fa-baby text-purple-600"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium">å­ä¾›ç”¨å“</p>
                                                <p class="text-sm text-gray-500">ãƒ™ãƒ“ãƒ¼ç”¨å“åº— - 2024/01/14</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-lg font-semibold text-red-600">Â¥12,000</p>
                                            <button class="text-gray-400 hover:text-gray-600">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 border rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                                <i class="fas fa-graduation-cap text-blue-600"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium">æ•™è‚²è²»</p>
                                                <p class="text-sm text-gray-500">å¡¾ä»£ - 2024/01/13</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-lg font-semibold text-red-600">Â¥25,000</p>
                                            <button class="text-gray-400 hover:text-gray-600">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-6">
                            <div class="card p-6">
                                <h3 class="text-lg font-semibold mb-4">ä»Šæœˆã®æ”¯å‡º</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">é£Ÿè²»</span>
                                        <span class="font-semibold">Â¥45,000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">å­ä¾›ç”¨å“</span>
                                        <span class="font-semibold">Â¥28,000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">æ•™è‚²è²»</span>
                                        <span class="font-semibold">Â¥35,000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">åŒ»ç™‚è²»</span>
                                        <span class="font-semibold">Â¥12,000</span>
                                    </div>
                                    <hr>
                                    <div class="flex justify-between text-lg font-bold">
                                        <span>åˆè¨ˆ</span>
                                        <span>Â¥120,000</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card p-6">
                                <h3 class="text-lg font-semibold mb-4">ğŸ’° ãŠå¾—æƒ…å ±</h3>
                                <div class="space-y-3">
                                    <div class="p-3 bg-green-50 rounded-lg">
                                        <p class="text-sm font-medium text-green-800">å­ä¾›ç”¨å“ç‰¹ä¾¡ã‚»ãƒ¼ãƒ«</p>
                                        <p class="text-xs text-green-600">æœ€å¤§50%OFF</p>
                                    </div>
                                    <div class="p-3 bg-blue-50 rounded-lg">
                                        <p class="text-sm font-medium text-blue-800">æ•™è‚²ãƒ­ãƒ¼ãƒ³ç›¸è«‡</p>
                                        <p class="text-xs text-blue-600">ç„¡æ–™ç›¸è«‡å®Ÿæ–½ä¸­</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Reports Page -->
            <div id="reports" class="page hidden p-6">
                <div class="max-w-7xl mx-auto">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">ãƒ¬ãƒãƒ¼ãƒˆ</h1>
                        <p class="text-gray-600">è©³ç´°ãªåˆ†æã¨ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">å¹´é–“è²¯è“„æ¨ç§»</h3>
                            <div class="chart-container">
                                <canvas id="yearlyChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">æ”¯å‡ºåˆ†æ</h3>
                            <div class="chart-container">
                                <canvas id="expenseAnalysisChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto">
                                <thead>
                                    <tr class="bg-gray-50">
                                        <th class="px-4 py-3 text-left">æœˆ</th>
                                        <th class="px-4 py-3 text-left">è²¯è“„é¡</th>
                                        <th class="px-4 py-3 text-left">æ”¯å‡ºé¡</th>
                                        <th class="px-4 py-3 text-left">å·®é¡</th>
                                        <th class="px-4 py-3 text-left">é”æˆç‡</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b">
                                        <td class="px-4 py-3">2024å¹´1æœˆ</td>
                                        <td class="px-4 py-3 text-green-600">Â¥85,000</td>
                                        <td class="px-4 py-3 text-red-600">Â¥120,000</td>
                                        <td class="px-4 py-3 text-red-600">-Â¥35,000</td>
                                        <td class="px-4 py-3">85%</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="px-4 py-3">2023å¹´12æœˆ</td>
                                        <td class="px-4 py-3 text-green-600">Â¥95,000</td>
                                        <td class="px-4 py-3 text-red-600">Â¥110,000</td>
                                        <td class="px-4 py-3 text-red-600">-Â¥15,000</td>
                                        <td class="px-4 py-3">95%</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="px-4 py-3">2023å¹´11æœˆ</td>
                                        <td class="px-4 py-3 text-green-600">Â¥100,000</td>
                                        <td class="px-4 py-3 text-red-600">Â¥105,000</td>
                                        <td class="px-4 py-3 text-red-600">-Â¥5,000</td>
                                        <td class="px-4 py-3">100%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Page -->
            <div id="settings" class="page hidden p-6">
                <div class="max-w-4xl mx-auto">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">è¨­å®š</h1>
                        <p class="text-gray-600">ã‚¢ãƒ—ãƒªã®è¨­å®šã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</p>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">è¡¨ç¤ºè¨­å®š</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium">è¨€èª</p>
                                        <p class="text-sm text-gray-500">è¡¨ç¤ºè¨€èªã‚’é¸æŠ</p>
                                    </div>
                                    <select id="languageSelect" class="input-field w-32">
                                        <option value="ja">æ—¥æœ¬èª</option>
                                        <option value="en">English</option>
                                    </select>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium">æ–‡å­—ã‚µã‚¤ã‚º</p>
                                        <p class="text-sm text-gray-500">èª­ã¿ã‚„ã™ã•ã‚’èª¿æ•´</p>
                                    </div>
                                    <select id="fontSizeSelect" class="input-field w-32">
                                        <option value="xs">æ¥µå°</option>
                                        <option value="sm">å°</option>
                                        <option value="base" selected>æ¨™æº–</option>
                                        <option value="lg">å¤§</option>
                                        <option value="xl">ç‰¹å¤§</option>
                                    </select>
                                </div>
                                

                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">é€šçŸ¥è¨­å®š</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium">æœˆæœ«ãƒ¬ãƒãƒ¼ãƒˆ</p>
                                        <p class="text-sm text-gray-500">æ¯æœˆã®æŒ¯ã‚Šè¿”ã‚Šãƒ¬ãƒãƒ¼ãƒˆ</p>
                                    </div>
                                    <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600 transition-colors">
                                        <span class="inline-block h-4 w-4 transform translate-x-6 rounded-full bg-white transition-transform"></span>
                                    </button>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium">ç›®æ¨™é”æˆã‚¢ãƒ©ãƒ¼ãƒˆ</p>
                                        <p class="text-sm text-gray-500">è²¯è“„ç›®æ¨™é”æˆæ™‚ã®é€šçŸ¥</p>
                                    </div>
                                    <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600 transition-colors">
                                        <span class="inline-block h-4 w-4 transform translate-x-6 rounded-full bg-white transition-transform"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
                            <div class="space-y-4">
                                <button class="btn btn-secondary">
                                    <i class="fas fa-download"></i>
                                    ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                                </button>
                                <button class="btn btn-primary">
                                    <i class="fas fa-sync-alt"></i>
                                    ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸ
                                </button>
                                <button class="btn btn-danger">
                                    <i class="fas fa-trash"></i>
                                    ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
                                </button>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold mb-4">ã‚¢ãƒ—ãƒªæƒ…å ±</h3>
                            <div class="space-y-2">
                                <p class="text-sm text-gray-600">ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0.0</p>
                                <p class="text-sm text-gray-600">æœ€çµ‚æ›´æ–°: 2024å¹´1æœˆ15æ—¥</p>
                                <div class="flex gap-4 mt-4">
                                    <a href="#" class="text-blue-600 hover:underline">åˆ©ç”¨è¦ç´„</a>
                                    <a href="#" class="text-blue-600 hover:underline">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
                                    <a href="#" class="text-blue-600 hover:underline">ãŠå•ã„åˆã‚ã›</a>
                                </div>
                                <div class="mt-4 pt-4 border-t border-gray-200">
                                    <p class="text-xs text-gray-500 text-center">
                                        Â© 2024 ãƒ•ã‚¡ãƒŸãƒªãƒ¼é¤Šè‚²è²»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ . All rights reserved.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Landing Page -->
            <div id="landing" class="page hidden">
                <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                    <div class="container mx-auto px-4 py-16">
                        <div class="text-center mb-16">
                            <h1 class="text-5xl font-bold text-gray-800 mb-4">
                                ãƒ•ã‚¡ãƒŸãƒªãƒ¼é¤Šè‚²è²»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
                            </h1>
                            <p class="text-xl text-gray-600 mb-8">
                                å¤«å©¦ã§å­ä¾›ã®é¤Šè‚²è²»ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã—ã€å°†æ¥ã®æ•™è‚²è²»ã‚’è¨ˆç”»çš„ã«è²¯è“„
                            </p>
                            <button class="btn btn-primary text-lg px-8 py-4">
                                ä»Šã™ãå§‹ã‚ã‚‹
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
                            <div class="text-center">
                                <i class="fas fa-piggy-bank text-4xl text-blue-600 mb-4"></i>
                                <h3 class="text-xl font-semibold mb-3">åŠ¹ç‡çš„ãªè²¯è“„ç®¡ç†</h3>
                                <p class="text-gray-600">æ•™è‚²è²»ã€ç¿’ã„äº‹ã€ç·Šæ€¥æ™‚ãªã©ç›®çš„åˆ¥ã«å£åº§ã‚’ç®¡ç†ã—ã€æœˆé¡ç›®æ¨™ã‚’è¨­å®šã—ã¦è¨ˆç”»çš„ã«è²¯è“„ã§ãã¾ã™ã€‚</p>
                            </div>
                            
                            <div class="text-center">
                                <i class="fas fa-users text-4xl text-green-600 mb-4"></i>
                                <h3 class="text-xl font-semibold mb-3">å¤«å©¦ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ</h3>
                                <p class="text-gray-600">å¤«å©¦é–“ã§è²¯è“„çŠ¶æ³ã¨æ”¯å‡ºã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å…±æœ‰ã—ã€å®¶è¨ˆç®¡ç†ã‚’åŠ¹ç‡åŒ–ã§ãã¾ã™ã€‚</p>
                            </div>
                            
                            <div class="text-center">
                                <i class="fas fa-chart-line text-4xl text-purple-600 mb-4"></i>
                                <h3 class="text-xl font-semibold mb-3">è©³ç´°ãªåˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆ</h3>
                                <p class="text-gray-600">æœˆæ¬¡ãƒ»å¹´æ¬¡ã®ãƒ¬ãƒãƒ¼ãƒˆã§æ”¯å‡ºå‚¾å‘ã‚’åˆ†æã—ã€å°†æ¥ã®æ•™è‚²è²»è¨ˆç”»ã‚’ç«‹ã¦ã‚‰ã‚Œã¾ã™ã€‚</p>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <h2 class="text-3xl font-bold text-gray-800 mb-8">å®Œå…¨ç„¡æ–™ã§åˆ©ç”¨å¯èƒ½</h2>
                            <p class="text-lg text-gray-600 mb-8">
                                GitHub Pagesä¸Šã§å‹•ä½œã—ã€é‹ç”¨è²»ã¯ä¸€åˆ‡ã‹ã‹ã‚Šã¾ã›ã‚“ã€‚<br>
                                ä»Šã™ãå§‹ã‚ã¦ã€å®¶æ—ã®å°†æ¥ã‚’è¨ˆç”»ã—ã¾ã—ã‚‡ã†ã€‚
                            </p>
                            <button class="btn btn-primary text-lg px-8 py-4">
                                ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Share Modal -->
        <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">çµæœã‚’ã‚·ã‚§ã‚¢</h3>
                <div class="space-y-3">
                    <button class="btn btn-primary w-full">
                        <i class="fab fa-twitter"></i>
                        Twitter ã§ã‚·ã‚§ã‚¢
                    </button>
                    <button class="btn btn-secondary w-full">
                        <i class="fab fa-facebook"></i>
                        Facebook ã§ã‚·ã‚§ã‚¢
                    </button>
                    <button class="btn btn-primary w-full">
                        <i class="fab fa-line"></i>
                        LINE ã§ã‚·ã‚§ã‚¢
                    </button>
                </div>
                <button id="closeShareModal" class="mt-4 text-gray-500 hover:text-gray-700">
                    é–‰ã˜ã‚‹
                </button>
            </div>
        </div>
        
        <!-- Add Account Modal -->
        <div id="addAccountModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">æ–°ã—ã„å£åº§ã‚’è¿½åŠ </h3>
                <form id="addAccountForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å£åº§å</label>
                        <input type="text" class="input-field" placeholder="ä¾‹: æ•™è‚²è²»å£åº§" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æœˆé–“ç›®æ¨™é¡</label>
                        <input type="number" class="input-field" placeholder="50000" required>
                    </div>
                    <div class="flex gap-3">
                        <button type="submit" class="btn btn-primary flex-1">è¿½åŠ </button>
                        <button type="button" id="closeAddAccountModal" class="btn btn-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Edit Account Modal -->
        <div id="editAccountModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">å£åº§ã‚’ç·¨é›†</h3>
                <form id="editAccountForm" class="space-y-4">
                    <input type="hidden" id="editAccountId" name="accountId">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å£åº§å</label>
                        <input type="text" id="editAccountName" name="name" class="input-field" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ç¾åœ¨ã®æ®‹é«˜</label>
                        <input type="number" id="editAccountBalance" name="balance" class="input-field" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æœˆé–“ç›®æ¨™é¡</label>
                        <input type="number" id="editAccountGoal" name="monthlyGoal" class="input-field" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">è²¯è“„ç›®æ¨™é¡</label>
                        <input type="number" id="editAccountTarget" name="targetAmount" class="input-field" placeholder="ä¾‹: 1000000">
                    </div>
                    <div class="flex gap-3">
                        <button type="submit" class="btn btn-primary flex-1">æ›´æ–°</button>
                        <button type="button" id="closeEditAccountModal" class="btn btn-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Add Expense Modal -->
        <div id="addExpenseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">æ”¯å‡ºã‚’è¿½åŠ </h3>
                <form id="addExpenseForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ã‚«ãƒ†ã‚´ãƒª</label>
                        <select class="input-field" required>
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="food">é£Ÿè²»</option>
                            <option value="childcare">å­ä¾›ç”¨å“</option>
                            <option value="education">æ•™è‚²è²»</option>
                            <option value="medical">åŒ»ç™‚è²»</option>
                            <option value="clothing">è¡£æœ</option>
                            <option value="entertainment">å¨¯æ¥½</option>
                            <option value="other">ãã®ä»–</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">é‡‘é¡</label>
                        <input type="number" class="input-field" placeholder="8500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">èª¬æ˜</label>
                        <input type="text" class="input-field" placeholder="ä¾‹: ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒãƒ¼ã‚±ãƒƒãƒˆ">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æ—¥ä»˜</label>
                        <input type="date" class="input-field" required>
                    </div>
                    <div class="flex gap-3">
                        <button type="submit" class="btn btn-primary flex-1">è¿½åŠ </button>
                        <button type="button" id="closeAddExpenseModal" class="btn btn-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let currentLanguage = 'ja';
        let currentFontSize = 'base';
        let isDarkMode = false;
        let supabase = null;
        let currentUser = null;
        
        // Supabase configuration
        const SUPABASE_URL = 'https://wtkdtskqqgtdjlcdmktr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind0a2R0c2txcWd0ZGpsY2Rta3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIxODI3NDEsImV4cCI6MjA2Nzc1ODc0MX0.2B7aJ8aeYINDchblUE3bA4ikRB94053LUzmGwW8MAzo';
        
        // Initialize Supabase
        try {
            if (window.supabase) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('Supabase initialized successfully');
            } else {
                console.warn('Supabase library not loaded, using demo mode');
                // Fallback for demo mode
                supabase = null;
            }
        } catch (error) {
            console.error('Supabase initialization error:', error);
            // Fallback for demo mode
            supabase = null;
        }
        
        // DOM elements
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const closeMobileMenu = document.getElementById('closeMobileMenu');
        const mobileMenu = document.getElementById('mobileMenu');
        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page');
        const themeToggle = document.getElementById('themeToggle');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const languageSelect = document.getElementById('languageSelect');
        const fontSizeSelect = document.getElementById('fontSizeSelect');
        
        // Translations
        const translations = {
            ja: {
                dashboard: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰',
                accounts: 'å£åº§ç®¡ç†',
                expenses: 'æ”¯å‡ºç®¡ç†',
                reports: 'ãƒ¬ãƒãƒ¼ãƒˆ',
                settings: 'è¨­å®š',
                thisMonth: 'ä»Šæœˆã®è²¯è“„é¡',
                monthlyExpenses: 'ä»Šæœˆã®æ”¯å‡º',
                totalSavings: 'ç·è²¯è“„é¡',
                goalProgress: 'ç›®æ¨™é”æˆç‡',
                recentTransactions: 'æœ€è¿‘ã®å–å¼•',
                addAccount: 'å£åº§è¿½åŠ ',
                addExpense: 'æ”¯å‡ºè¿½åŠ '
            },
            en: {
                dashboard: 'Dashboard',
                accounts: 'Accounts',
                expenses: 'Expenses',
                reports: 'Reports',
                settings: 'Settings',
                thisMonth: 'This Month Savings',
                monthlyExpenses: 'Monthly Expenses',
                totalSavings: 'Total Savings',
                goalProgress: 'Goal Progress',
                recentTransactions: 'Recent Transactions',
                addAccount: 'Add Account',
                addExpense: 'Add Expense'
            }
        };
        
        // Chart instances
        let savingsChart = null;
        let expensesChart = null;
        let yearlyChart = null;
        let expenseAnalysisChart = null;
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('Initializing app...');
                initializeApp();
                setupEventListeners();
                loadUserPreferences();
                
                // Wait a bit for external scripts to load
                setTimeout(() => {
                    try {
                        initializeCharts();
                    } catch (chartError) {
                        console.warn('Chart initialization failed:', chartError);
                    }
                }, 1000);
                
                checkAuthStatus();
                console.log('App initialization complete');
            } catch (error) {
                console.error('App initialization error:', error);
                // Fallback: show dashboard even if there's an error
                showPage('dashboard');
            }
        });
        
        function initializeApp() {
            // Show dashboard by default
            showPage('dashboard');
            
            // Initialize PWA - Service Worker registration moved to end of file
        }
        
        function setupEventListeners() {
            // Mobile menu
            mobileMenuToggle.addEventListener('click', () => {
                mobileMenu.classList.add('active');
            });
            
            closeMobileMenu.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
            });
            
            // Navigation
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = item.getAttribute('data-page');
                    showPage(page);
                    mobileMenu.classList.remove('active');
                });
            });
            
            // Account edit buttons
            document.querySelectorAll('.edit-account-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const accountType = btn.getAttribute('data-account');
                    openEditAccountModal(accountType);
                });
            });
            
            // Settings
            languageSelect.addEventListener('change', changeLanguage);
            fontSizeSelect.addEventListener('change', changeFontSize);
            
            // Modals
            document.getElementById('addAccountBtn').addEventListener('click', () => {
                document.getElementById('addAccountModal').classList.remove('hidden');
            });
            
            document.getElementById('addExpenseBtn').addEventListener('click', () => {
                document.getElementById('addExpenseModal').classList.remove('hidden');
            });
            
            document.getElementById('closeAddAccountModal').addEventListener('click', () => {
                document.getElementById('addAccountModal').classList.add('hidden');
            });
            
            document.getElementById('closeAddExpenseModal').addEventListener('click', () => {
                document.getElementById('addExpenseModal').classList.add('hidden');
            });
            
            document.getElementById('closeEditAccountModal').addEventListener('click', () => {
                document.getElementById('editAccountModal').classList.add('hidden');
            });
            
            // Forms
            document.getElementById('addAccountForm').addEventListener('submit', handleAddAccount);
            document.getElementById('editAccountForm').addEventListener('submit', handleEditAccount);
            document.getElementById('addExpenseForm').addEventListener('submit', handleAddExpense);
            
            // Share functionality
            document.getElementById('closeShareModal').addEventListener('click', () => {
                document.getElementById('shareModal').classList.add('hidden');
            });
        }
        
        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
                page.classList.add('hidden');
            });
            
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('active');
                targetPage.classList.add('slide-in');
            }
            
            // Update active navigation
            navItems.forEach(item => {
                item.classList.remove('bg-blue-50', 'text-blue-700');
                if (item.getAttribute('data-page') === pageId) {
                    item.classList.add('bg-blue-50', 'text-blue-700');
                }
            });
        }
        
        function openEditAccountModal(accountType) {
            const modal = document.getElementById('editAccountModal');
            const form = document.getElementById('editAccountForm');
            
            // Set account data based on type
            const accountData = getAccountData(accountType);
            
            document.getElementById('editAccountId').value = accountType;
            document.getElementById('editAccountName').value = accountData.name;
            document.getElementById('editAccountBalance').value = accountData.balance;
            document.getElementById('editAccountGoal').value = accountData.monthlyGoal;
            document.getElementById('editAccountTarget').value = accountData.targetAmount || '';
            
            modal.classList.remove('hidden');
        }
        
        function getAccountData(accountType) {
            const accounts = {
                education: {
                    name: 'æ•™è‚²è²»å£åº§',
                    balance: 850000,
                    monthlyGoal: 50000,
                    targetAmount: 2000000
                },
                hobby: {
                    name: 'ç¿’ã„äº‹å£åº§',
                    balance: 320000,
                    monthlyGoal: 30000,
                    targetAmount: 500000
                },
                emergency: {
                    name: 'ç·Šæ€¥æ™‚å£åº§',
                    balance: 80000,
                    monthlyGoal: 20000,
                    targetAmount: 300000
                }
            };
            
            return accounts[accountType] || {};
        }
        
        function changeLanguage() {
            currentLanguage = languageSelect.value;
            updateLanguage();
            saveUserPreferences();
        }
        
        function changeFontSize() {
            currentFontSize = fontSizeSelect.value;
            document.body.className = document.body.className.replace(/font-size-\w+/, `font-size-${currentFontSize}`);
            saveUserPreferences();
        }
        
        function updateLanguage() {
            const t = translations[currentLanguage];
            
            // Update navigation
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (t[key]) {
                    element.textContent = t[key];
                }
            });
        }
        
        function saveUserPreferences() {
            const preferences = {
                language: currentLanguage,
                fontSize: currentFontSize
            };
            localStorage.setItem('userPreferences', JSON.stringify(preferences));
        }
        
        function loadUserPreferences() {
            const stored = localStorage.getItem('userPreferences');
            if (stored) {
                const preferences = JSON.parse(stored);
                currentLanguage = preferences.language || 'ja';
                currentFontSize = preferences.fontSize || 'base';
                
                languageSelect.value = currentLanguage;
                fontSizeSelect.value = currentFontSize;
                
                updateLanguage();
                changeFontSize();
            }
        }
        
        function initializeCharts() {
            try {
                // Check if Chart.js is loaded
                if (typeof Chart === 'undefined') {
                    console.warn('Chart.js not loaded, skipping chart initialization');
                    return;
                }
                
                // Savings chart
                const savingsCtx = document.getElementById('savingsChart');
                if (savingsCtx) {
                    savingsChart = new Chart(savingsCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
                            datasets: [{
                                label: 'è²¯è“„é¡',
                                data: [80000, 85000, 90000, 87000, 92000, 85000],
                                borderColor: '#10B981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return 'Â¥' + value.toLocaleString();
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Expenses chart
                const expensesCtx = document.getElementById('expensesChart');
                if (expensesCtx) {
                    expensesChart = new Chart(expensesCtx.getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: ['é£Ÿè²»', 'å­ä¾›ç”¨å“', 'æ•™è‚²è²»', 'åŒ»ç™‚è²»', 'ãã®ä»–'],
                            datasets: [{
                                data: [45000, 28000, 35000, 12000, 8000],
                                backgroundColor: [
                                    '#EF4444',
                                    '#8B5CF6',
                                    '#3B82F6',
                                    '#10B981',
                                    '#F59E0B'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }
                
                // Yearly chart
                const yearlyCtx = document.getElementById('yearlyChart');
                if (yearlyCtx) {
                    yearlyChart = new Chart(yearlyCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ['2020', '2021', '2022', '2023', '2024'],
                            datasets: [{
                                label: 'å¹´é–“è²¯è“„é¡',
                                data: [800000, 950000, 1100000, 1200000, 1250000],
                                backgroundColor: '#3B82F6'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return 'Â¥' + value.toLocaleString();
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Expense analysis chart
                const expenseAnalysisCtx = document.getElementById('expenseAnalysisChart');
                if (expenseAnalysisCtx) {
                    expenseAnalysisChart = new Chart(expenseAnalysisCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
                            datasets: [{
                                label: 'é£Ÿè²»',
                                data: [40000, 42000, 45000, 43000, 47000, 45000],
                                borderColor: '#EF4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)'
                            }, {
                                label: 'æ•™è‚²è²»',
                                data: [30000, 32000, 35000, 33000, 37000, 35000],
                                borderColor: '#3B82F6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return 'Â¥' + value.toLocaleString();
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Chart initialization error:', error);
            }
        }
        
        function handleAddAccount(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const accountData = {
                name: formData.get('name'),
                monthlyGoal: parseInt(formData.get('monthlyGoal')),
                balance: 0,
                userId: currentUser?.id
            };
            
            // Add to Supabase (when configured)
            // addAccountToDatabase(accountData);
            
            document.getElementById('addAccountModal').classList.add('hidden');
            e.target.reset();
        }
        
        function handleAddExpense(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const expenseData = {
                category: formData.get('category'),
                amount: parseInt(formData.get('amount')),
                description: formData.get('description'),
                date: formData.get('date'),
                userId: currentUser?.id
            };
            
            // Add to Supabase (when configured)
            // addExpenseToDatabase(expenseData);
            
            document.getElementById('addExpenseModal').classList.add('hidden');
            e.target.reset();
        }
        
        function handleEditAccount(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const accountData = {
                id: formData.get('accountId'),
                name: formData.get('name'),
                balance: parseInt(formData.get('balance')),
                monthlyGoal: parseInt(formData.get('monthlyGoal')),
                targetAmount: parseInt(formData.get('targetAmount')) || 0,
                userId: currentUser?.id
            };
            
            // Update account data in UI
            updateAccountDisplay(accountData);
            
            // Add to Supabase (when configured)
            // updateAccountInDatabase(accountData);
            
            document.getElementById('editAccountModal').classList.add('hidden');
        }
        
        function updateAccountDisplay(accountData) {
            // Update the account display based on account type
            const accountType = accountData.id;
            const accountCards = {
                education: document.querySelector('[data-account="education"]').closest('.card'),
                hobby: document.querySelector('[data-account="hobby"]').closest('.card'),
                emergency: document.querySelector('[data-account="emergency"]').closest('.card')
            };
            
            const card = accountCards[accountType];
            if (card) {
                // Update account name
                card.querySelector('h3').textContent = accountData.name;
                
                // Update balance
                const balanceElement = card.querySelector('.text-3xl');
                balanceElement.textContent = `Â¥${accountData.balance.toLocaleString()}`;
                
                // Update monthly goal
                const goalElement = card.querySelector('.text-sm:last-of-type');
                if (goalElement && goalElement.textContent.includes('Â¥')) {
                    goalElement.textContent = `Â¥${accountData.monthlyGoal.toLocaleString()}`;
                }
                
                // Update target amount if exists
                const targetElement = card.querySelector('.text-sm:contains("è²¯è“„ç›®æ¨™")');
                if (targetElement && accountData.targetAmount > 0) {
                    const progress = (accountData.balance / accountData.targetAmount * 100).toFixed(1);
                    const progressBar = card.querySelector('.progress-fill.bg-green-500');
                    if (progressBar) {
                        progressBar.style.width = `${Math.min(progress, 100)}%`;
                    }
                    const progressText = card.querySelector('.text-xs:contains("ç›®æ¨™é”æˆç‡")');
                    if (progressText) {
                        progressText.textContent = `ç›®æ¨™é”æˆç‡: ${progress}%`;
                    }
                }
            }
        }
        
        function checkAuthStatus() {
            // Check if user is logged in
            const userSession = localStorage.getItem('userSession');
            if (userSession) {
                try {
                    currentUser = JSON.parse(userSession);
                    showDashboard();
                } catch (error) {
                    console.error('Session parsing error:', error);
                    localStorage.removeItem('userSession');
                    showAuthModal();
                }
            } else {
                // For demo purposes, show dashboard directly
                // In production, you would show auth modal here
                handleDemoLogin();
            }
        }
        
        function showAuthModal() {
            // Create and show authentication modal
            const authModal = document.createElement('div');
            authModal.innerHTML = `
                <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
                    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                        <h3 class="text-xl font-semibold mb-4">ãƒ­ã‚°ã‚¤ãƒ³ãƒ»æ–°è¦ç™»éŒ²</h3>
                        <form id="authForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                                <input type="email" name="email" class="input-field" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                                <input type="password" name="password" class="input-field" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-full">ãƒ­ã‚°ã‚¤ãƒ³</button>
                        </form>
                        <p class="text-center text-sm text-gray-600 mt-4">
                            ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„å ´åˆã¯ã€è‡ªå‹•çš„ã«æ–°è¦ç™»éŒ²ã•ã‚Œã¾ã™
                        </p>
                        <div class="text-center mt-4">
                            <button id="demoLogin" class="text-blue-600 hover:text-blue-800 text-sm">
                                ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã§è©¦ã™
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(authModal);
            
            // Add event listeners
            const authForm = authModal.querySelector('#authForm');
            const demoLoginBtn = authModal.querySelector('#demoLogin');
            
            authForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(authForm);
                const email = formData.get('email');
                const password = formData.get('password');
                
                // Handle authentication
                handleAuthentication(email, password);
            });
            
            demoLoginBtn.addEventListener('click', () => {
                handleDemoLogin();
            });
        }
        
        function handleAuthentication(email, password) {
            try {
                // Initialize Supabase if not already done
                if (!supabase) {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                }
                
                // Try to sign in
                supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                }).then(({ data, error }) => {
                    if (error) {
                        // If sign in fails, try to sign up
                        supabase.auth.signUp({
                            email: email,
                            password: password
                        }).then(({ data: signUpData, error: signUpError }) => {
                            if (signUpError) {
                                console.error('Sign up error:', signUpError);
                                showNotification('ã‚¨ãƒ©ãƒ¼', 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + signUpError.message, 'error');
                            } else {
                                showNotification('æˆåŠŸ', 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚', 'success');
                                // For demo purposes, proceed anyway
                                handleDemoLogin();
                            }
                        }).catch(error => {
                            console.error('Sign up catch error:', error);
                            showNotification('ã‚¨ãƒ©ãƒ¼', 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                            handleDemoLogin();
                        });
                    } else {
                        showNotification('æˆåŠŸ', 'ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ', 'success');
                        currentUser = data.user;
                        localStorage.setItem('userSession', JSON.stringify(data.user));
                        showDashboard();
                    }
                }).catch(error => {
                    console.error('Sign in catch error:', error);
                    showNotification('ã‚¨ãƒ©ãƒ¼', 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                    handleDemoLogin();
                });
            } catch (error) {
                console.error('Authentication setup error:', error);
                showNotification('ã‚¨ãƒ©ãƒ¼', 'èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                handleDemoLogin();
            }
        }
        
        function handleDemoLogin() {
            currentUser = { id: 'demo-user', email: 'demo@example.com' };
            localStorage.setItem('userSession', JSON.stringify(currentUser));
            const authModal = document.querySelector('.fixed.inset-0');
            if (authModal) {
                document.body.removeChild(authModal);
            }
            showDashboard();
        }
        
        function showDashboard() {
            // Hide auth modal if exists
            const authModal = document.querySelector('.fixed.inset-0');
            if (authModal) {
                document.body.removeChild(authModal);
            }
            
            // Show dashboard page
            showPage('dashboard');
            
            // Update navigation active state
            navItems.forEach(item => {
                item.classList.remove('bg-blue-50', 'text-blue-700');
            });
            
            const dashboardNav = document.querySelector('[data-page="dashboard"]');
            if (dashboardNav) {
                dashboardNav.classList.add('bg-blue-50', 'text-blue-700');
            }
        }
        
        // Share functionality
        function shareResults(platform) {
            const url = window.location.href;
            const text = 'å®¶æ—ã®é¤Šè‚²è²»ç®¡ç†ã‚’åŠ¹ç‡åŒ–ï¼æœˆé¡è²¯è“„ã¨æ”¯å‡ºã‚’è¦‹ãˆã‚‹åŒ–ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚';
            
            let shareUrl = '';
            switch (platform) {
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
                    break;
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
                    break;
                case 'line':
                    shareUrl = `https://line.me/R/msg/text/?${encodeURIComponent(text + ' ' + url)}`;
                    break;
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
            }
        }
        
        // PWA install prompt
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            deferredPrompt = e;
            showInstallPrompt();
        });
        
        function showInstallPrompt() {
            const installBanner = document.createElement('div');
            installBanner.innerHTML = `
                <div class="fixed bottom-4 left-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-50">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-mobile-alt text-2xl"></i>
                            <div>
                                <p class="font-semibold">ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</p>
                                <p class="text-sm opacity-90">ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¦ç°¡å˜ã‚¢ã‚¯ã‚»ã‚¹</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button id="installApp" class="btn btn-primary">ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</button>
                            <button id="dismissInstall" class="btn btn-secondary">å¾Œã§</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(installBanner);
            
            document.getElementById('installApp').addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        deferredPrompt = null;
                        document.body.removeChild(installBanner);
                    });
                }
            });
            
            document.getElementById('dismissInstall').addEventListener('click', () => {
                document.body.removeChild(installBanner);
            });
        }
        
        // Offline functionality
        function handleOffline() {
            const offlineBanner = document.createElement('div');
            offlineBanner.innerHTML = `
                <div class="fixed top-0 left-0 right-0 bg-yellow-500 text-white p-2 text-center z-50">
                    <i class="fas fa-wifi-slash mr-2"></i>
                    ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œä¸­
                </div>
            `;
            document.body.appendChild(offlineBanner);
        }
        
        function handleOnline() {
            const offlineBanner = document.querySelector('.fixed.top-0.bg-yellow-500');
            if (offlineBanner) {
                document.body.removeChild(offlineBanner);
            }
        }
        
        window.addEventListener('offline', handleOffline);
        window.addEventListener('online', handleOnline);
        
        // Error handling
        window.addEventListener('error', (e) => {
            console.error('Application error:', e);
            // Show user-friendly error message
            const errorToast = document.createElement('div');
            errorToast.innerHTML = `
                <div class="fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <p class="font-semibold">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</p>
                            <p class="text-sm">ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(errorToast);
            
            setTimeout(() => {
                document.body.removeChild(errorToast);
            }, 5000);
        });
        
        // Performance monitoring
        if ('performance' in window) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    console.log('Page load time:', perfData.loadEventEnd - perfData.loadEventStart);
                }, 0);
            });
        }
        
        // Analytics tracking (Google Analytics)
        function trackEvent(eventName, category, action, label) {
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, {
                    event_category: category,
                    event_action: action,
                    event_label: label
                });
            }
        }
        
        // Usage tracking
        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                const page = item.getAttribute('data-page');
                trackEvent('navigation', 'click', page);
            });
        });
        
        // Accessibility enhancements
        document.addEventListener('keydown', (e) => {
            // ESC key to close modals
            if (e.key === 'Escape') {
                document.querySelectorAll('.fixed.inset-0').forEach(modal => {
                    if (!modal.classList.contains('hidden')) {
                        modal.classList.add('hidden');
                    }
                });
            }
            
            // Tab navigation for accessibility
            if (e.key === 'Tab') {
                document.body.classList.add('keyboard-navigation');
            }
        });
        
        document.addEventListener('mousedown', () => {
            document.body.classList.remove('keyboard-navigation');
        });
        
        // Focus management
        function trapFocus(modal) {
            const focusableElements = modal.querySelectorAll(
                'button, input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];
            
            modal.addEventListener('keydown', (e) => {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstElement) {
                            lastElement.focus();
                            e.preventDefault();
                        }
                    } else {
                        if (document.activeElement === lastElement) {
                            firstElement.focus();
                            e.preventDefault();
                        }
                    }
                }
            });
            
            firstElement.focus();
        }
        
        // Initialize focus trap for modals
        document.querySelectorAll('.fixed.inset-0').forEach(modal => {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        if (!modal.classList.contains('hidden')) {
                            trapFocus(modal);
                        }
                    }
                });
            });
            
            observer.observe(modal, { attributes: true });
        });
        
        // Data persistence
        function saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error('Failed to save to localStorage:', e);
            }
        }
        
        function loadFromLocalStorage(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.error('Failed to load from localStorage:', e);
                return null;
            }
        }
        
        // Export/Import functionality
        function exportData() {
            const data = {
                accounts: loadFromLocalStorage('accounts') || [],
                expenses: loadFromLocalStorage('expenses') || [],
                settings: loadFromLocalStorage('userPreferences') || {}
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'family-budget-data.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function importData(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    saveToLocalStorage('accounts', data.accounts);
                    saveToLocalStorage('expenses', data.expenses);
                    saveToLocalStorage('userPreferences', data.settings);
                    location.reload();
                } catch (error) {
                    alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                }
            };
            reader.readAsText(file);
        }
        
        // Backup and sync
        function createBackup() {
            const backup = {
                timestamp: new Date().toISOString(),
                data: {
                    accounts: loadFromLocalStorage('accounts') || [],
                    expenses: loadFromLocalStorage('expenses') || [],
                    settings: loadFromLocalStorage('userPreferences') || {}
                }
            };
            
            saveToLocalStorage('backup', backup);
        }
        
        // Create backup every hour
        setInterval(createBackup, 3600000);
        
        // Initialize backup on load
        createBackup();
        
        // Search functionality
        function searchTransactions(query) {
            const transactions = loadFromLocalStorage('expenses') || [];
            return transactions.filter(transaction => 
                transaction.description.toLowerCase().includes(query.toLowerCase()) ||
                transaction.category.toLowerCase().includes(query.toLowerCase())
            );
        }
        
        // Add search to expenses page
        const expensesPage = document.getElementById('expenses');
        const searchInput = document.createElement('input');
        searchInput.type = 'text';
        searchInput.placeholder = 'æ”¯å‡ºã‚’æ¤œç´¢...';
        searchInput.className = 'input-field mb-4';
        searchInput.addEventListener('input', (e) => {
            const results = searchTransactions(e.target.value);
            // Update expense list with search results
            // Implementation depends on your data structure
        });
        
        // Add to expenses page
        const expensesContent = expensesPage.querySelector('.max-w-7xl');
        if (expensesContent) {
            expensesContent.insertBefore(searchInput, expensesContent.firstChild);
        }
        
        // Notification system
        function showNotification(title, message, type = 'info') {
            const notification = document.createElement('div');
            const typeColors = {
                info: 'bg-blue-500',
                success: 'bg-green-500',
                warning: 'bg-yellow-500',
                error: 'bg-red-500'
            };
            
            notification.innerHTML = `
                <div class="fixed top-4 right-4 ${typeColors[type]} text-white p-4 rounded-lg shadow-lg z-50 max-w-sm">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'info-circle'} text-xl"></i>
                        <div>
                            <h4 class="font-semibold">${title}</h4>
                            <p class="text-sm">${message}</p>
                        </div>
                        <button class="text-white hover:text-gray-200 ml-2">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            notification.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(notification);
            });
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 5000);
        }
        
        // Budget alerts
        function checkBudgetAlerts() {
            const expenses = loadFromLocalStorage('expenses') || [];
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthlyExpenses = expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.getMonth() === currentMonth && 
                       expenseDate.getFullYear() === currentYear;
            });
            
            const totalExpenses = monthlyExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            const budgetLimit = 150000; // Example budget limit
            
            if (totalExpenses > budgetLimit * 0.8) {
                showNotification(
                    'äºˆç®—ã‚¢ãƒ©ãƒ¼ãƒˆ',
                    `ä»Šæœˆã®æ”¯å‡ºãŒäºˆç®—ã®80%ã‚’è¶…ãˆã¾ã—ãŸã€‚ç¾åœ¨: Â¥${totalExpenses.toLocaleString()}`,
                    'warning'
                );
            }
        }
        
        // Check budget alerts on page load
        checkBudgetAlerts();
        
        // Update last activity timestamp
        function updateLastActivity() {
            saveToLocalStorage('lastActivity', new Date().toISOString());
        }
        
        // Update activity on user interaction
        document.addEventListener('click', updateLastActivity);
        document.addEventListener('keydown', updateLastActivity);
        
        // Cleanup function
        function cleanup() {
            // Clean up event listeners and timers
            if (savingsChart) savingsChart.destroy();
            if (expensesChart) expensesChart.destroy();
            if (yearlyChart) yearlyChart.destroy();
            if (expenseAnalysisChart) expenseAnalysisChart.destroy();
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', cleanup);
        
        // Initialize tooltips
        function initializeTooltips() {
            const tooltips = document.querySelectorAll('[data-tooltip]');
            tooltips.forEach(element => {
                element.addEventListener('mouseenter', showTooltip);
                element.addEventListener('mouseleave', hideTooltip);
            });
        }
        
        function showTooltip(e) {
            const tooltip = document.createElement('div');
            tooltip.className = 'absolute bg-gray-800 text-white p-2 rounded text-sm z-50';
            tooltip.textContent = e.target.getAttribute('data-tooltip');
            
            document.body.appendChild(tooltip);
            
            const rect = e.target.getBoundingClientRect();
            tooltip.style.left = rect.left + 'px';
            tooltip.style.top = (rect.bottom + 5) + 'px';
        }
        
        function hideTooltip() {
            const tooltip = document.querySelector('.absolute.bg-gray-800');
            if (tooltip) {
                document.body.removeChild(tooltip);
            }
        }
        
        // Initialize on load
        initializeTooltips();
    </script>
    
    <!-- Service Worker -->
    <script>
        const SW_CODE = `
            const CACHE_NAME = 'family-budget-v1';
            const urlsToCache = [
                '/',
                '/index.html',
                'https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css',
                'https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css',
                'https://cdn.jsdelivr.net/npm/chart.js'
            ];
            
            self.addEventListener('install', (event) => {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then((cache) => cache.addAll(urlsToCache))
                );
            });
            
            self.addEventListener('fetch', (event) => {
                event.respondWith(
                    caches.match(event.request)
                        .then((response) => {
                            if (response) {
                                return response;
                            }
                            return fetch(event.request);
                        })
                );
            });
        `;
        
        // Create service worker blob
        const swBlob = new Blob([SW_CODE], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(swBlob);
        
        if ('serviceWorker' in navigator) {
            try {
                // Try external sw.js first
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => console.log('External SW registered successfully'))
                    .catch(error => {
                        console.log('External SW registration failed:', error);
                        // Fallback to inline SW
                        navigator.serviceWorker.register(swUrl)
                            .then(registration => console.log('Inline SW registered successfully'))
                            .catch(inlineError => console.log('Inline SW also failed:', inlineError));
                    });
            } catch (error) {
                console.error('Service Worker setup error:', error);
            }
        }
    </script>
    
    <!-- PWA Manifest -->
    <script>
        const manifest = {
            name: 'ãƒ•ã‚¡ãƒŸãƒªãƒ¼é¤Šè‚²è²»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ',
            short_name: 'é¤Šè‚²è²»ç®¡ç†',
            description: 'å¤«å©¦ã§å­ä¾›ã®é¤Šè‚²è²»ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³',
            start_url: '/',
            display: 'standalone',
            background_color: '#ffffff',
            theme_color: '#3B82F6',
            icons: [
                {
                    src: 'https://via.placeholder.com/192x192/3B82F6/ffffff?text=FB',
                    sizes: '192x192',
                    type: 'image/png'
                },
                {
                    src: 'https://via.placeholder.com/512x512/3B82F6/ffffff?text=FB',
                    sizes: '512x512',
                    type: 'image/png'
                }
            ]
        };
        
        const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
        const manifestUrl = URL.createObjectURL(manifestBlob);
        
        const manifestLink = document.createElement('link');
        manifestLink.rel = 'manifest';
        manifestLink.href = manifestUrl;
        document.head.appendChild(manifestLink);
    </script>
</body>
</html>